var W4Library={$W4L__deps:["$log","$W4Audio"],$W4L__postset:'log.trace("JS: export W4 global library"); Module["W4L"]=W4L; abort=W4L.abort ',$W4L:{__UpdateWorking__:!1,__times:[],__fps:1,load:function(e,t){log.trace("JS: load script : "+e);var r=document.createElement("script");r.src=e,document.body.appendChild(r),r.onload=t},onPause:function(){var e=W4Audio.getGlobalGain();W4Audio.setGlobalGain(0);var t=function(){W4Audio.setGlobalGain(e),document.removeEventListener("touchstart",t)};document.addEventListener("touchstart",t)},setUpdate:function(e){var t=this;this.updateCallbackFn=e,function e(r){t.updateCallbackId=window.requestAnimationFrame(e),t.updateCallbackFn()}(),this.__UpdateWorking__=!0},stopUpdate:function(){log.trace("JS: stop update"),this.updateCallbackId?(cancelAnimationFrame(this.updateCallbackId),this.__UpdateWorking__=!1):log.error("JS: call stopUpdate() without set callback function")},startUpdate:function(){log.trace("JS: start update"),this.updateCallbackFn?this.setUpdate(this.updateCallbackFn):log.error("JS: call startUpdate() without set callback function")},toggleUpdate:function(){this.__UpdateWorking__?this.stopUpdate():this.startUpdate()},abort:function(e){log.error(stackTrace()),fatalError(e)},alertPrint:function(e){alert(JSON.stringify(e))}},openFullscreen:function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},w4_BaseLib_Init:function(){log.info("JS: W4 baselib is loaded!")},w4_BaseLib_Print:function(e,t){var r=UTF8ToString(e),n=document.getElementById(r);n?n.innerHTML=UTF8ToString(t):log.error("W4L: can't find element "+r)},w4_BaseLib_setVisible:function(e,t){var r=UTF8ToString(e),n=document.getElementById(r);n?n.style.display=t?"block":"none":log.error("W4L: can't find element "+r)}};autoAddDeps(W4Library,"$W4L"),autoAddDeps(W4Library,"$fatalError"),mergeInto(LibraryManager.library,W4Library);var FatalError={FatalError__deps:["$log","$W4L"],$fatalError:function(e){throw log.error("JS: "+e),W4L.stopUpdate(),alert("JS: W4 FATAL ERROR:\n\n"+e),"JS: W4L: TERMINATE :  "+e},w4lAbort:function(e){fatalError(UTF8ToString(e))},w4lReload:function(){location.reload()}};mergeInto(LibraryManager.library,FatalError);var LibraryOuterID={$OuterID:{_table:{},_deleters:{},_id:1,invalid:0,make:function(e,t){return null==e?0:(OuterID._table[OuterID._id]=e,e.__outerId=OuterID._id,t&&(OuterID._deleters[OuterID._id]=t),OuterID._id++)},isValid:function(e){return e!==OuterID.invalid},get:function(e){return e in OuterID._table||fatalError("Invalid pointer index "+e),OuterID._table[e]},free:function(e){var t=OuterID._table[e];e in OuterID._table||fatalError("Double free "+e),t=OuterID._table[e],e in OuterID._deleters&&(OuterID._deleters[e](t),delete OuterID._deleters[e]),delete OuterID._table[e]}},OuterID_delete:function(e){OuterID.free(e)}};autoAddDeps(LibraryOuterID,"$OuterID"),autoAddDeps(LibraryOuterID,"$fatalError"),mergeInto(LibraryManager.library,LibraryOuterID);var PodGeneratorImpl={$PodGenerator__deps:["$log"],$PodGenerator:{types:{},defaultTypeConvertions:{bool:function(e,t){return new Int8Array(wasmMemory.buffer,e,t)},int:function(e,t){return new Int32Array(wasmMemory.buffer,e,t)},int32_t:function(e,t){return new Int32Array(wasmMemory.buffer,e,t)},uint32_t:function(e,t){return new Uint32Array(wasmMemory.buffer,e,t)},uint:function(e,t){return new Uint32Array(wasmMemory.buffer,e,t)},float:function(e,t){return new Float32Array(wasmMemory.buffer,e,t)},"w4::core::OuterID::ndxType":function(e,t){return new Int32Array(wasmMemory.buffer,e,t)},TextureOuterId:function(e,t){return new Int32Array(wasmMemory.buffer,e,t)},utf8CharPtr:function(e,t){return new Int32Array(wasmMemory.buffer,e,t)},"w4::math::size":function(e,t){return new Uint32Array(wasmMemory.buffer,e,2*t)},"w4::math::point":function(e,t){return new Uint32Array(wasmMemory.buffer,e,2*t)},"w4::math::ivec2":function(e,t){return new Int32Array(wasmMemory.buffer,e,2*t)},"w4::math::vec2":function(e,t){return new Float32Array(wasmMemory.buffer,e,2*t)},"w4::math::vec3":function(e,t){return new Float32Array(wasmMemory.buffer,e,3*t)},"w4::math::vec4":function(e,t){return new Float32Array(wasmMemory.buffer,e,4*t)},"w4::math::mat3":function(e,t){return new Float32Array(wasmMemory.buffer,e,9*t)},"w4::math::mat4":function(e,t){return new Float32Array(wasmMemory.buffer,e,16*t)},"w4::math::rect":function(e,t){return new Float32Array(wasmMemory.buffer,e,4*t)}},createProxy:function(e,t,r){var n=r.control,a=new Int8Array(wasmMemory.buffer,t+n,1);return new Proxy(e,{ctr:a,set:function(e,t,r,n){return e[t]=r,this.ctr[0]=1,!0}})},createPodRepl:function(e,t){var r={__meta:{}};for(var n in t.descr){var a=t.descr[n];if("count"in a){for(var o=[],i=0;i<a.count;++i){var s=this.createField(e+a.offset+a.size*i,a.type,1);"control"in a&&(s=this.createProxy(s,e,a)),o.push(s)}r[n]=o;var l={type:a.type,isArray:!0};r.__meta[n]=l}else{s=this.createField(e+a.offset,a.type,1);if("control"in a&&(s=this.createProxy(s,e,a)),null!=s){r[n]=s;l={type:a.type,isArray:!1};r.__meta[n]=l}}}return r},createField:function(e,t,r){var n=this.defaultTypeConvertions[t];if(n)return n(e,r);var a=this.types[t];if(a){var o=OuterID.get(a);return this.createPodRepl(e,o)}},registerPOD:function(e,t){var r=OuterID.get(t),n=this.createPodRepl(e,r);return OuterID.make(n,PodGenerator.deletePOD)},deletePOD:function(e){},registerType:function(e){var t=OuterID.make({descr:{}},PodGenerator.deleteTypeDescr);return this.types[AsciiToString(e)]=t,t},deleteTypeDescr:function(e){}},w4lTypeGetSize:function(e){var t=OuterID.get(e),r=0;for(var n in t.descr)r+=t.descr[n].size;return r},w4lPODRegister:function(e,t){return PodGenerator.registerPOD(e,t)},w4lTypeRegister:function(e){return PodGenerator.registerType(e)},w4lTypeFieldRegister:function(e,t,r,n,a,o,i){var s=OuterID.get(e),l={};l.type=AsciiToString(r),l.offset=n,l.size=a,o>0&&(l.count=o),i&&(l.control=!0),s.descr[AsciiToString(t)]=l}};autoAddDeps(PodGeneratorImpl,"$Platform"),autoAddDeps(PodGeneratorImpl,"$PodGenerator"),autoAddDeps(PodGeneratorImpl,"$OuterID"),mergeInto(LibraryManager.library,PodGeneratorImpl);var RestImpl={$REST:{convertMethod:function(e){switch(e){case 1:return"GET";case 2:return"POST";case 3:return"PUT";case 4:return"DELETE"}},send:function(e,t,r,n,a){return new Promise(function(a,o){var i=new XMLHttpRequest;if(i.open(e,encodeURI(t),!0),void 0!==r)for(var s in r){var l=r[s];i.setRequestHeader(s,l)}i.onload=function(){200==i.status?a({type:i.getResponseHeader("Content-Type"),data:i.response,code:i.status,text:i.statusText}):o({code:i.status,text:i.statusText})},i.onabort=function(){o({code:-2,text:i.statusText})},i.onerror=function(){o({code:-1,text:i.statusText})},void 0===n?i.send():i.send(n)})}},REST_send__deps:["$REST"],REST_send:function(e,t,r,n,a,o){var i=void 0;0!=n&&(i=UTF8ToString(n));var s=void 0;if(0!=r){var l=UTF8ToString(r);""!==l&&(s=JSON.parse(l))}return REST.send(REST.convertMethod(e),UTF8ToString(t),s,i).then(function(e){var t=lengthBytesUTF8(e.data)+1,r=Module._malloc(t);stringToUTF8(e.data,r,t),wasmTable.get(o)(a,e.code,r),Module._free(r)},function(e){var t=lengthBytesUTF8(e.text)+1,r=Module._malloc(t);stringToUTF8(e.text,r,t),wasmTable.get(o)(a,e.code,r),Module._free(r)})}};mergeInto(LibraryManager.library,RestImpl),mergeInto(LibraryManager.library,{w4lTimerGetCurrentSystemTime:function(){return+new Date}});var FilesystemImpl={$W4FS:{Files:{},loaded:!1,UnpackCallback:void 0,getArchiveFilePath:function(e){var t=e.split(".")[0];return"/"==t.charAt(0)&&(t=t.substr(1)),t},onFileReceived:function(e,t){if(t.type&&t.type.includes("w4pack")||e.includes("w4pack")){var r=t.data;if(void 0!==r){var n=r.byteLength,a=Module._malloc(n),o=new Uint8Array(Module.HEAPU8.buffer,a,n);o.set(new Uint8Array(r)),W4FS.UnpackCallback=function(e,t,r,n){var a=new Uint8Array(wasmMemory.buffer,r,n),o={type:UTF8ToString(t),data:a};W4FS.put(UTF8ToString(e),o)},Module._loadZipFile(o.byteOffset,n)}}else W4FS.put(e,t)},open:function(e,t){if(!this.parse(e,t,this.onFileReceived)){return function(t){return XHR.get(t).then(function(t){W4FS.onFileReceived(e,t)},function(e){fatalError("XML HTTP Request: "+t+" on error status: "+e.code+" "+e.text)})}(t)}},Ascii85:{_alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&()*+-;<=>?@^_`{|}~",decode:function(e){var t,r,n,a,o,i,s=W4FS.Ascii85._alphabet,l="";for(n=0,o=e.length;n<o;){for(t=[0,0,0,0,0],a=0;a<5;a++)e[n]&&(t[a]=s.indexOf(e[n++]));for(r=t[0],a=1;a<5;a++)r=85*r+t[a];for(i=[0,0,0,0],a=0;a<4;a++)i[3-a]=String.fromCharCode(r%256),r=Math.floor(r/256);for(a=0;a<4;a++)l+=i[a]}return l}},parse:function(e,t,r){var n=t.substring(0,64),a=n.indexOf(";base85,");if(-1!=a){for(var o=n.substring(5,a),i=t.substring(a+";base85,".length),s=W4FS.Ascii85.decode(i),l=s.length,u=new ArrayBuffer(l),d=new Uint8Array(u),c=0;c<l;c++)d[c]=s.charCodeAt(c);return r(e,{type:o,data:u}),!0}return!1},close:function(e){delete W4FS.Files[e]},put:function(e,t){W4FS.Files[e]=t},isExists:function(e){return!(void 0===W4FS.Files[e])},isURL:function(e){var t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol},get:function(e){var t=W4FS.Files[e];return void 0===t&&(console.log(W4FS.Files),fatalError("No file "+e+" in file system")),t}},$W4Utils__deps:["$W4FS"],$W4Utils:{current:0,total:0,loadFilesFromConfig:function(e,t){if(0!==Object.keys(e).length){var r=[];for(var n in e)r.push(W4FS.open(n,e[n]));Promise.all(r).then(function(){Module.VFSLoadedCallback&&Module.VFSLoadedCallback(),wasmTable.get(t)()})}else wasmTable.get(t)()}},VFS_init__deps:["$W4FS","$W4Utils"],VFS_init:function(e){W4FS.Files={},Module.getFileFromVFS=W4FS.get,Module.isFileSystemValid=W4FS.isLoaded,null!=window.W4_VFS_DEC?W4Utils.loadFilesFromConfig(window.W4_VFS_DEC,e):fatalError("W4_VFS_DEC not found. File system is not declared")},VFS_sync__deps:["$W4FS"],VFS_sync:function(e,t,r){var n=W4FS.get(UTF8ToString(e));if(null!=n){var a=n.data;if(void 0!==a){var o=a.byteLength,i=Module._malloc(o),s=new Uint8Array(Module.HEAPU8.buffer,i,o);s.set(new Uint8Array(a)),wasmTable.get(r)(t,s.byteOffset,o)}else wasmTable.get(r)(t,null,0)}else fatalError("VFS_sync: "+e+" file not found ")},FetchStream_sync__deps:["$W4FS"],FetchStream_sync:function(e,t,r){var n;n=UTF8ToString(e),XHR.get(n).then(function(e){var n=e.data;if(void 0!==n){var a=n.byteLength,o=Module._malloc(a),i=new Uint8Array(Module.HEAPU8.buffer,o,a);i.set(new Uint8Array(n));var s=lengthBytesUTF8(e.text)+1,l=Module._malloc(s);stringToUTF8(e.text,l,s),wasmTable.get(r)(t,i.byteOffset,a,e.code,l),Module._free(l)}else s=lengthBytesUTF8(e.text)+1,l=Module._malloc(s),stringToUTF8(e.text,l,s),wasmTable.get(r)(t,null,0,e.code,l),Module._free(l)},function(e){var n=lengthBytesUTF8(e.text)+1,a=Module._malloc(n);stringToUTF8(e.text,a,n),wasmTable.get(r)(t,null,0,e.code,a),Module._free(a)})},VFS_clean:function(e){W4FS.Files={},wasmTable.get(e)()},VFS_UnpackCallback:function(e,t,r,n){W4FS.UnpackCallback&&W4FS.UnpackCallback(e,t,r,n)},VFS_pathExists:function(e){return UTF8ToString(e)in W4FS.Files?1:0}};autoAddDeps(FilesystemImpl,"$fatalError"),autoAddDeps(FilesystemImpl,"$IDB"),autoAddDeps(FilesystemImpl,"$XHR"),autoAddDeps(FilesystemImpl,"$W4FS"),mergeInto(LibraryManager.library,FilesystemImpl),mergeInto(LibraryManager.library,{$IDB__deps:[],$IDB:{db:null,DB_NAME:"W4DB",DB_STORE_NAME:"FILE_STORE",DIR_SEPARATOR:"/",onError:function(){console.log("IDB.onError")},indexedDB:function(){if("undefined"!=typeof indexedDB)return indexedDB;var e=null;return"object"==typeof window&&(e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB),e},open:function(){return new Promise(function(e,t){if(null!==IDB.db&&void 0!==IDB.db&&IDB.db.name===IDB.DB_NAME)return console.log("IDB.db already exists"),void e();var r=IDB.indexedDB().open(IDB.DB_NAME);r.onerror=function(){console.log("IDB.open() onerror"),t()},r.onupgradeneeded=function(t){(IDB.db=t.target.result,IDB.db.onerror=IDB.onError,IDB.db.objectStoreNames.contains(IDB.DB_STORE_NAME))?e():IDB.db.createObjectStore(IDB.DB_STORE_NAME).onsuccess=function(){e()}},r.onsuccess=function(t){IDB.db=r.result,IDB.db.onerror=IDB.onError,e()}})},close:function(){null!==IDB.db&&void 0!==IDB.db&&IDB.db.close(),IDB.db=null},drop:function(){return new Promise(function(e,t){var r=IDB.indexedDB().deleteDatabase(IDB.DB_NAME);r.onsuccess=function(t){e(t)},r.onerror=function(e){t(e)},IDB.close()})},put:function(e,t){return new Promise(function(r,n){if(null!==IDB.db&&void 0!==IDB.db){var a=IDB.db.transaction([IDB.DB_STORE_NAME],"readwrite");a.onabort=function(){n()},a.onerror=function(){n()},a.oncomplete=function(){r()};a.objectStore(IDB.DB_STORE_NAME).put(t,e)}else n()})},get:function(e){return new Promise(function(t,r){if(null!==IDB.db&&void 0!==IDB.db){var n=IDB.db.transaction([IDB.DB_STORE_NAME],"readonly");n.onabort=function(){r()},n.onerror=function(){r()},n.oncomplete=function(){t(o.result)};var a=IDBKeyRange.bound(e,e+IDB.DIR_SEPARATOR,!1,!0),o=n.objectStore(IDB.DB_STORE_NAME).get(a)}else r()})},delete:function(e){return new Promise(function(t,r){if(null!==IDB.db&&void 0!==IDB.db){var n=IDB.db.transaction([IDB.DB_STORE_NAME],"readwrite");n.onabort=function(){r()},n.onerror=function(){r()},n.oncomplete=function(){t()};var a=IDBKeyRange.bound(e,e+IDB.DIR_SEPARATOR,!1,!0);n.objectStore(IDB.DB_STORE_NAME).delete(a)}else r()})},count:function(e){return new Promise(function(t,r){if(null!==IDB.db&&void 0!==IDB.db){var n=IDB.db.transaction([IDB.DB_STORE_NAME],"readwrite");n.onabort=function(){r()},n.onerror=function(){r()},n.oncomplete=function(){t(o.result)};var a=IDBKeyRange.bound(e,e+IDB.DIR_SEPARATOR,!1,!0),o=n.objectStore(IDB.DB_STORE_NAME).count(a)}else r()})}}}),mergeInto(LibraryManager.library,{$XHR__deps:["$fatalError"],$XHR:{get:function(e,t){return new Promise(function(r,n){var a=new XMLHttpRequest;a.open("GET",encodeURIComponent(e.trim()),!0),a.responseType=t||"arraybuffer",a.onload=function(){200==a.status?r({type:a.getResponseHeader("Content-Type"),data:a.response,code:a.status,text:a.statusText}):n({code:a.status,text:a.statusText})},a.onabort=function(){n({code:-2,text:a.statusText})},a.onerror=function(){n({code:-1,text:a.statusText})},a.send()})},post:function(e,t,r){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("POST",e,!0),a.onload=function(){200==a.status?t(a.response):n(a.statusText)},a.onabort=function(e){n(e)},a.onerror=function(e){console.error("Xhr.post code: ",a.status,", error: ",a.statusText),n(e)},a.send(r)})}}});var LoggerLib={$log:{trace:function(e){this.__internal.writeLog(this.__internal.Level.TRACE,0,e)},debug:function(e){this.__internal.writeLog(this.__internal.Level.DEBUG,0,e)},info:function(e){this.__internal.writeLog(this.__internal.Level.INFO,0,e)},warning:function(e){this.__internal.writeLog(this.__internal.Level.WARNING,0,e)},error:function(e){this.__internal.writeLog(this.__internal.Level.ERROR,0,e)},__internal:{remote:{clientId:void 0,connected:!1,address:void 0,lastTimeConnected:0,lastErrorTime:0,reconnectTimeout:5e3},Level:{TRACE:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4,FATAL:5},Color:{0:"LightSlateGray",1:"darkgray",2:"darkcyan",3:"DarkGoldenRod",4:"maroon",5:"purple",6:"steelblue",7:"gray",8:"mediumpurple",9:"chocolate",10:"red",11:"crimson"},indentLevel:0,pushIndentLevel:function(){log.__internal.indentLevel+=1},popIndentLevel:function(){log.__internal.indentLevel>0&&(log.__internal.indentLevel-=1)},writeLog:function(e,t,r,n,a){this.writeLocalLog(Date.now(),e,t,r,n,a)},writeLocalLog:function(e,t,r,n,a,o){for(var i=new Date(e),s=i.getMilliseconds()+"";s.length<3;)s="0"+s;var l=i.getDate()+"."+i.getMonth()+"."+i.getFullYear()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+"."+s,u=Object.keys(this.Level)[t][0],d=this.Color[t+r],c="%c";t>this.Level.WARNING&&void 0!==a&&(c+="("+a,void 0!==o&&(c+=":"+o),c+=")"),console.log("%c"+l+" ["+u+"] "+"  ".repeat(log.__internal.indentLevel)+n+c,"color:"+d,"color:black"),"object"==typeof n&&console.dir(n),t>this.Level.ERROR&&console.log((new Error).stack)},writeRemoteLog:function(e,t,r,n,a,o){var i={id:this.remote.clientId,level:t,timestamp:e,message:n};void 0!==a&&(i.fileName=a,void 0!==o&&(i.lineNumber=o)),t>this.Level.ERROR&&(i.stack=(new Error).stack),fetch(this.remote.address,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(function(){log.__internal.remote.connected=!0},function(i){var s=new Error,l=Date.now();log.__internal.remote.connected=!1,log.__internal.remote.lastTimeConnected=l,l-log.__internal.remote.lastErrorTime>log.__internal.remote.reconnectTimeout&&(log.__internal.writeLocalLog(log.__internal.remote.lastTimeConnected,log.__internal.Level.ERROR,0,"fail send log to remote server '"+log.__internal.remote.address+"': "+i,s.fileName,s.lineNumber),log.__internal.remote.lastErrorTime=l),log.__internal.writeLocalLog(e,t,r,n,a,o)})}},initialize:function(e,t){this.__internal.remote.clientId=e,this.__internal.remote.address=t}},w4lLogInit:function(e,t){log.initialize(UTF8ToString(e),0===t?void 0:UTF8ToString(t))},w4lLog:function(e,t,r,n){log.__internal.writeLog(e,6,UTF8ToString(n),UTF8ToString(t),r)},w4lLogPushIndentLevel:function(){log.__internal.pushIndentLevel()},w4lLogPopIndentLvel:function(){log.__internal.popIndentLevel()}};autoAddDeps(LoggerLib,"$log"),mergeInto(LibraryManager.library,LoggerLib);var LibraryMultiplayer={$Multiplayer__deps:["$log"],$__MultiplayerInternal:{__buf2Json:function(e,t,r){TypeEnum={String:0,Float:1,Int:2,Bool:3};for(var n=0;n<r;){var a=t.getUint16(n,!0).toString();n+=2;var o,i=t.getUint16(n,!0);switch(n+=2,i){case TypeEnum.Bool:o=!!t.getUint32(n,!0),n+=4;break;case TypeEnum.Int:o=t.getInt32(n,!0),n+=4;break;case TypeEnum.Float:o=t.getFloat32(n,!0),n+=4;break;case TypeEnum.String:var s=t.getUint16(n,!0);o="";for(var l,u=(n+=2)+s;n<u;++n)l=t.getUint8(n),o+=String.fromCharCode(l>251&&l<254&&n+5<u?1073741824*(l-252)+(t.getUint8(++n)-128<<24)+(t.getUint8(++n)-128<<18)+(t.getUint8(++n)-128<<12)+(t.getUint8(++n)-128<<6)+t.getUint8(++n)-128:l>247&&l<252&&n+4<u?(l-248<<24)+(t.getUint8(++n)-128<<18)+(t.getUint8(++n)-128<<12)+(t.getUint8(++n)-128<<6)+t.getUint8(++n)-128:l>239&&l<248&&n+3<u?(l-240<<18)+(t.getUint8(++n)-128<<12)+(t.getUint8(++n)-128<<6)+t.getUint8(++n)-128:l>223&&l<240&&n+2<u?(l-224<<12)+(t.getUint8(++n)-128<<6)+t.getUint8(++n)-128:l>191&&l<224&&n+1<u?(l-192<<6)+t.getUint8(++n)-128:l);var d=(s+2)%4;n+=d?4-d:0}e[a]=o}},__getUniqueString:function(){var e=2147483648;return Math.floor(Math.random()*e).toString(36)+Math.abs(Math.floor(Math.random()*e)^Date.now()).toString(36)},Connection:function(e){this.uri=e,this.__requestPreProcess=function(e){},this.__responsePostProcess=function(e){},this.__doRequest=function(e,t,r,n,a){var o="application/json; charset=utf-8",i=new XMLHttpRequest;i.open(e,this.uri+t,!0),i.overrideMimeType(o),i.setRequestHeader("Accept",o),r&&i.setRequestHeader("Content-Type",o),this.__requestPreProcess(i);var s=this;i.onreadystatechange=function(e){if(this.readyState===XMLHttpRequest.DONE){if(200===this.status){var t=JSON.parse(this.responseText);s.__responsePostProcess(t),n(t)}else a(this.responseText);this.abort(),this.onreadystatechange=function(e){}}},r?i.send(JSON.stringify(r)):i.send()}},WebSockConnection:function(e,t,r,n,a,o,i,s,l,u,d,c,g,f){var _=this;this.onMatched=i,this.postponedUpdates=f,this.entityId=n,this.dataView=e,this.reset=function(){this.delayedStates={},this.initializationStep=0,this.playerSlotsFilled=[],this.maxSlotNumber=-1,this.playersCount=0,this.myIndex=-1,this.playersCountReported=!1,this.fullStatesRequested={},this.statesFull=new Set,this.userDataState=void 0,this.playerSlotsState=void 0,this.matchId=void 0},this.reset(),this.webSock=new WebSocket(t,r),this.webSock.onopen=a,this.webSock.onclose=function(e){e.wasClean?log.error("websock: Connection closed by server"):log.error("websock: Connection breaks"),log.error("websock: error code "+e.code+" ,reason: "+e.reason),o()},this.webSock.onerror=function(e){log.error("websock error!"),this.onclose=function(){},this.close(),o()},this.webSock.onmessage=function(t){function r(t){if(t.payload.stateId===_.playerSlotsState){for(var r in t.payload.data){var n=t.payload.data[r],a=Number(r);if(a>_.maxSlotNumber&&(_.maxSlotNumber=a),n){if("undefined"!==n){if(_.playerSlotsFilled[a]=!0,"BOT"!==n)JSON.parse(n).pf_entity_id===_.entityId&&(_.myIndex=a,s(_.myIndex,g)),a+1>_.playersCount&&(_.playersCount=a+1)}}else _.playerSlotsFilled[a]=!1,_.playersCountReported&&d(a,g)}for(var o=0,i=0;i<_.playerSlotsFilled.length;++i)_.playerSlotsFilled[i]&&++o;o===_.maxSlotNumber+1?(_.onMatched(),_.playersCountReported=!0,u(_.playersCount,g)):l(_.playersCount)}else if(!_.userDataState&&t.payload.hasOwnProperty("meta")&&"players_state_runtime"==t.payload.meta.name&&(_.userDataState=t.payload.stateId),t.payload.stateId===_.userDataState){var f=_.__json2buf(_.dataView,t.payload.data);c(e.bufferPtr,f,g)}}var n=JSON.parse(t.data);switch(_.initializationStep){case 0:if("event_message"===n.type&&"matching_result"===n.payload.subject){i();var a=JSON.parse(n.payload.text);for(var o in _.userDataState=void 0,_.playerSlotsState=a.states.user_slots_info,_.matchId=a.w4_match_id,++_.initializationStep,_.delayedStates){r(_.delayedStates[o]),++_.initializationStep}_.delayedStates={},_.__checkPostponed()}else"full_state"===n.type?(_.delayedStates[n.payload.stateId]=n,_.statesFull.add(n.payload.stateId)):"state_delta"===n.type&&(_.statesFull.has(n.payload.stateId)?r(n):_.__requestFullState(n.payload.stateId));break;case 1:case 2:"full_state"===n.type?(r(n),delete _.fullStatesRequested[n.correlationId],_.statesFull.add(n.payload.stateId),++_.initializationStep,_.__checkPostponed()):"state_delta"===n.type&&(_.statesFull.has(n.payload.stateId)?r(n):_.__requestFullState(n.payload.stateId));break;default:"full_state"===n.type?(r(n),_.statesFull.add(n.payload.stateId)):"state_delta"===n.type?(r(n),_.statesFull.has(n.payload.stateId)||_.__requestFullState(n.payload.stateId)):"event_message"===n.type?log.debug("Skipped event message"):log.error("Unexpected ws message: "+n.payload.text)}},this.__checkPostponed=function(){if(this.initializationStep>=2&&this.userDataState){for(var e=0;e<this.postponedUpdates.length;++e){var t={id:__MultiplayerInternal.__getUniqueString(),payload:{stateId:this.userDataState,data:this.postponedUpdates[e]},type:"update_state"};this.webSock.send(JSON.stringify(t))}this.postponedUpdates={}}},this.__requestFullState=function(e){for(var t in Object.values(this.fullStatesRequested))if(t===e)return;var r=__MultiplayerInternal.__getUniqueString(),n={id:r,payload:{stateId:e},type:"get_full_state"};this.webSock.send(JSON.stringify(n)),this.fullStatesRequested[r]=e},this.isReady=function(){return this.userDataState},this.update=function(e){var t={id:__MultiplayerInternal.__getUniqueString(),payload:{stateId:this.userDataState,data:{}},type:"update_state"};this.__buf2Json(t.payload.data,this.dataView,e),this.webSock.send(JSON.stringify(t))},this.__json2buf=function(e,t){TypeEnum={String:0,Float:1,Int:2,Bool:3};var r=0;for(var n in t){var a=t[n];if(e.setUint16(r,parseInt(n),!0),r+=2,!1===a||!0===a)e.setUint16(r,TypeEnum.Bool,!0),r+=2,e.setUint32(r,a?1:0,!0),r+=4;else if(Number.isFinite(a))Number.isInteger(a)?(e.setUint16(r,TypeEnum.Int,!0),r+=2,e.setInt32(r,a,!0),r+=4):(e.setUint16(r,TypeEnum.Float,!0),r+=2,e.setFloat32(r,a,!0),r+=4);else{e.setUint16(r,TypeEnum.String,!0);for(var o=r+=4,i=0,s=a.length;i<s;++i){var l=a.charCodeAt(i);l<128?e.setUint8(r++,l):l<2048?(e.setUint8(r++,192|l>>6),e.setUint8(r++,128|63&l)):l<55296||l>=57344?(e.setUint8(r++,224|l>>12),e.setUint8(r++,128|l>>6&63),e.setUint8(r++,128|63&l)):(e.setUint8(r++,239),e.setUint8(r++,191),e.setUint8(r++,189))}var u=r-o;e.setUint16(o-2,u,!0);var d=(u+2)%4;r+=d?4-d:0}}return r},this.__buf2Json=function(e,t,r){__MultiplayerInternal.__buf2Json(e,t,r)}},doMatchmakingRequest:function(e){e.stateCallback(Multiplayer.State.MatchmakingRequested),e.w4MatchmakingConnect.__doRequest("POST","/match_request",{matchingType:"CAMPAIGN",userInfo:{userW4SessionId:e.w4Connect.sessionId,userPfId:e.userLogin,userPfEntityId:e.userLogin,userLevel:e.userLevel},userWishes:{campaignSize:e.campaignSize,manifestId:e.manifestId}},function(t){e.stateCallback(Multiplayer.State.MatchMakingWaiting)},function(t){e.stateCallback(Multiplayer.State.MatchmakingError)})}},$Multiplayer__deps:["$__MultiplayerInternal"],$Multiplayer:{State:{LoggingIn:0,LoggingError:1,WebsockConnecting:2,WebsockError:3,MatchmakingRequested:4,MatchmakingError:5,MatchMakingWaiting:6,Complete:7},create:function(e,t,r,n,a,o,i,s,l,u,d,c,g,f,_){var p=0,m=function(e){wasmTable.get(f)(e,p,_)},h=function(e){p=e,m(Multiplayer.State.MatchMakingWaiting)};this.hasOwnProperty("uniqueName")||(this.uniqueName=__MultiplayerInternal.__getUniqueString());var v=new DataView(Module.HEAPU8.buffer,e,t);v.bufferPtr=e;var b={postponedUpdates:[],dataView:v,userLogin:o,userLevel:i,campaignSize:s,manifestId:l,stateCallback:m};return b.w4Connect=new __MultiplayerInternal.Connection(r),b.w4Connect.__doRequest("GET","/fakelogin/"+o,void 0,function(e){m(Multiplayer.State.WebsockConnecting),b.w4Connect.sessionId=e.sessionId,b.websockConn=new __MultiplayerInternal.WebSockConnection(v,a+"/websocket",["JSESSIONID_"+b.w4Connect.sessionId,"xxx"],o,function(){setTimeout(()=>{b.w4MatchmakingConnect=new __MultiplayerInternal.Connection(n),__MultiplayerInternal.doMatchmakingRequest(b)},100)},function(){m(Multiplayer.State.WebsockError),log.error("Websock connection error!")},function(){m(Multiplayer.State.Complete),log.info("Matched")},wasmTable.get(u),h,wasmTable.get(d),wasmTable.get(c),wasmTable.get(g),_,b.postponedUpdates)},function(e){m(Multiplayer.State.LoggingError),console.error(e)}),m(Multiplayer.State.LoggingIn),OuterID.make(b)},destroy:function(e,t){var r=OuterID.get(e);r.w4MatchmakingConnect&&r.w4MatchmakingConnect.__doRequest("POST","/exit_match",{userW4SessionId:r.w4Connect.sessionId,matchId:r.websockConn.matchId},function(e){t()},function(e){t()})},update:function(e,t){var r=OuterID.get(e);if(r.websockConn&&r.websockConn.isReady())r.websockConn.update(t);else{var n={};__MultiplayerInternal.__buf2Json(n,r.dataView,t),r.postponedUpdates.push(n)}},rematch:function(e){this.destroy(e,function(){var t=OuterID.get(e);t.playersCountReported=!1,t.websockConn.reset(),t.postponedUpdates=[],__MultiplayerInternal.doMatchmakingRequest(t)})}},w4_Multiplayer_initialize:function(e,t,r,n,a,o,i,s,l,u,d,c,g,f){var _=new Uint8Array(32);window.crypto.getRandomValues(_);var p=0,m="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=_[p++]/16|0;return("x"==e?t:3&t|8).toString(16)});return Multiplayer.create(e,t,UTF8ToString(r),UTF8ToString(n),UTF8ToString(a),m,o,i,UTF8ToString(s),l,u,d,c,g,f)},w4_Multiplayer_update:function(e,t){Multiplayer.update(e,t)},w4_Multiplayer_disconnect:function(e){Multiplayer.destroy(e,function(){OuterID.free(e)})},w4_Multiplayer_rematch:function(e){Multiplayer.rematch(e)}};autoAddDeps(LibraryMultiplayer,"$Multiplayer"),mergeInto(LibraryManager.library,LibraryMultiplayer);var LibraryAudio={$W4Audio:{initialize:function(){this.__internal={context:new(window.AudioContext||window.webkitAudioContext),State:{IDLE:0,PLAYED:1,PAUSED:2},items:{},globalGain:1,delete:function(e){e&&e.sourceNode&&e.sourceNode.stop()},decodeFloat:function(e){return e/16777215},decodeBool:function(e){return e>0},setGlobalGain:function(e){for(var t in this.globalGain=e,this.items){var r=this.items[t],n=this.globalGain*r.gain;r.gainNode.gain.setValueAtTime(n,this.context.currentTime)}},getGlobalGain:function(){return this.globalGain},setGain:function(e,t){e.gain=t;var r=this.globalGain*e.gain;e.gainNode.gain.setValueAtTime(r,this.context.currentTime)},setGainLinear:function(e,t,r){e.gain=t;var n=this.globalGain*e.gain;e.gainNode.gain.linearRampToValueAtTime(n,this.context.currentTime+r)},getGain:function(e){return e.gainNode.gain.value},setIsLooped:function(e,t){e.loop=t,e.sourceNode&&(e.sourceNode.loop=e.loop),log.trace(e.description+": isLooped="+t)},getIsLooped:function(e){return e.loop},play:function(e){if(e.state!==this.State.IDLE&&W4Audio.__internal.stop(e),e.buffer){e.sourceNode=this.context.createBufferSource(),e.sourceNode.buffer=e.buffer,e.sourceNode.connect(e.gainNode),e.sourceNode.addEventListener("ended",function(){"onended"in e&&e.onended(),e.sourceNode=null,e.state,W4Audio.__internal.State.PLAYED}),e.sourceNode.start(0),e.sourceNode.loop=e.loop;var t=this.globalGain*e.gain;e.gainNode.gain.setValueAtTime(t,this.context.currentTime),e.startTime=Date.now(),e.state=this.State.PLAYED}else e.onbufferset=function(){W4Audio.__internal.play(e)}},pause:function(e){e.state===this.State.PLAYED?(e.state=this.State.PAUSED,e.startOffset=e.startOffset+(Date.now()-e.startTime)/1e3,e.startOffset-=Math.floor(e.startOffset/e.buffer.duration),e.sourceNode.stop(),log.trace(e.description+": pause")):log.warning(e.description+": fail to pause - not played")},resume:function(e){if(e.state===this.State.PAUSED){e.state=this.State.PLAYED,e.sourceNode=this.context.createBufferSource(),e.sourceNode.buffer=e.buffer,e.sourceNode.connect(e.gainNode),e.sourceNode.addEventListener("ended",function(){"onended"in e&&e.onended(),e.sourceNode=null,e.state===W4Audio.__internal.State.PLAYED&&log.trace(e.description+": ended")}),e.sourceNode.start(0,e.startOffset),e.sourceNode.loop=e.loop;var t=this.globalGain*e.gain;e.gainNode.gain.setValueAtTime(t,this.context.currentTime),e.startTime=Date.now(),log.trace(e.description+": resume")}else log.warning(e.description+": fail to resume - not paused")},stop:function(e){if(e.sourceNode)switch(e.state){case this.State.IDLE:return;case this.State.PLAYED:e.sourceNode.stop()}e.state=this.State.IDLE},isPlaying:function(e){return e.state===this.State.PLAYED}};var e=function(){W4Audio.__internal.context.resume().then(function(){log.info("W4Audio context initialized (by touch): "+W4Audio.__internal.context.state)}),document.removeEventListener("touchstart",e,!1),document.removeEventListener("click",e,!1)};document.addEventListener("touchstart",e);var t=function(){W4Audio.__internal.context.resume().then(function(){log.info("W4Audio context initialized (by click)"+W4Audio.__internal.context.state)}),document.removeEventListener("touchstart",t,!1),document.removeEventListener("click",t,!1)};document.addEventListener("click",t)},create:function(e){var t={state:this.__internal.State.IDLE,gainNode:this.__internal.context.createGain(),sourceNode:null,buffer:null,startTime:0,startOffset:0,gain:1,loop:!1};t.gainNode.connect(this.__internal.context.destination);var r=this.__internal.globalGain*t.gain;t.gainNode.gain.setValueAtTime(r,this.__internal.context.currentTime),AudioData.get(e).then(function(e){t.description+="["+e.source+"]",t.buffer=e.buffer,"onbufferset"in t&&t.onbufferset(),log.trace(t.description+": loaded")});var n=OuterID.make(t,this.__internal.delete);return t.description="W4Audio("+n+")",this.__internal.items[n]=t,n},playStandalone:function(e,t,r,n){var a=this.create(e),o=OuterID.get(a);o.onbufferset=function(){W4Audio.__internal.play(o)},o.onended=function(){this.delete(a),n(a)},W4Audio.__internal.setGain(o,t),W4Audio.__internal.setIsLooped(o,r)},getGain:function(e){return this.__internal.getGain(OuterID.get(e))},setGain:function(e,t){this.__internal.setGain(OuterID.get(e),t)},setGlobalGain:function(e){this.__internal.setGlobalGain(e)},getGlobalGain:function(){return this.__internal.getGlobalGain()},setGainLinear:function(e,t,r){this.__internal.setGainLinear(OuterID.get(e),t,r)},getIsLooped:function(e){return this.__internal.getIsLooped(OuterID.get(e))},setIsLooped:function(e,t){this.__internal.setIsLooped(OuterID.get(e),t)},play:function(e){this.__internal.play(OuterID.get(e))},pause:function(e){this.__internal.pause(OuterID.get(e))},resume:function(e){this.__internal.resume(OuterID.get(e))},stop:function(e){this.__internal.stop(OuterID.get(e))},isPlaying:function(e){return this.__internal.isPlaying(OuterID.get(e))},delete:function(e){var t=OuterID.get(e);this.__internal.items.hasOwnProperty(t)&&delete this.__internal.items[t],OuterID.free(e)}},w4_Audio_initialize:function(){W4Audio.initialize()},w4_Audio_create:function(e){return W4Audio.create(e)},w4_Audio_delete:function(e){W4Audio.delete(e)},w4_Audio_play:function(e){W4Audio.play(e)},w4_Audio_stop:function(e){W4Audio.stop(e)},w4_Audio_pause:function(e){W4Audio.pause(e)},w4_Audio_resume:function(e){W4Audio.resume(e)},w4_Audio_setGain:function(e,t){W4Audio.setGain(e,W4Audio.__internal.decodeFloat(t))},w4_Audio_setGlobalGain:function(e){W4Audio.setGlobalGain(W4Audio.__internal.decodeFloat(e))},w4_Audio_getGlobalGain:function(){return W4Audio.getGlobalGain()},w4_Audio_getGain:function(e){return W4Audio.getGain(e)},w4_Audio_setGainLinear:function(e,t,r){W4Audio.setGainLinear(e,W4Audio.__internal.decodeFloat(t),W4Audio.__internal.decodeFloat(r))},w4_Audio_setIsLooped:function(e,t){W4Audio.setIsLooped(e,W4Audio.__internal.decodeBool(t))},w4_Audio_playStandalone:function(e,t,r,n){W4Audio.playStandalone(e,W4Audio.__internal.decodeFloat(t),W4Audio.__internal.decodeBool(r),wasmTable.get(n))},w4_Audio_isPlaying:function(e){return W4Audio.isPlaying(e)}};autoAddDeps(LibraryAudio,"$W4Audio"),mergeInto(LibraryManager.library,LibraryAudio);var LibraryAudioData={$AudioData:{initialize:function(){this.__internal={context:new(window.AudioContext||window.webkitAudioContext)}},create:function(e){var t=this.__internal.context,r={source:e,__callbacks:[]},n=W4FS.get(e);void 0===n&&fatalError("file '"+e+"' not found");var a=n.data.slice(0);return a.buffer&&(a=a.buffer),t.decodeAudioData(a,function(e){for(var t in r.buffer=e,r.__callbacks.forEach(function(e){e()}),r)"buffer"!==t&&"source"!==t&&delete r[t];Object.freeze(r)},function(t){log.error("fail to decode audio data '"+e+"': "+t),fatalError()}),OuterID.make(r)},get:function(e){return new Promise(function(t){var r=OuterID.get(e);"buffer"in r?t(r):r.__callbacks.push(function(){t(r)})})},delete:function(e){OuterID.free(e)}},w4_AudioData_initialize:function(){AudioData.initialize()},w4_AudioData_create:function(e){return AudioData.create(UTF8ToString(e))},w4_AudioData_delete:function(e){AudioData.delete(e)}};autoAddDeps(LibraryAudioData,"$AudioData"),mergeInto(LibraryManager.library,LibraryAudioData);var LibraryPlatform={$Platform__postset:"var gl; Module.Platform = Platform; var isSafari = Platform.isSafari();",$Platform__deps:["$log","$W4L"],$Platform:{baseDiv:void 0,canvas:void 0,mousePress:void 0,gamePadCount:0,gamepadData:void 0,onResizeCB:void 0,ctxVersion:void 0,hasDepthTextures:!1,hasFloatTextures:!1,depthSupportedFormat:void 0,aspectW:9,aspectH:16,isSafari:function(){var e=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS");return!0!==e&&(e=!1),e},getMousePos:function(e,t){var r=e.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}},getPlatformKeyboardCode:function(e){switch(e){case"Digit1":return 49;case"Digit2":return 50;case"Digit3":return 51;case"Digit4":return 52;case"Digit5":return 53;case"Digit6":return 54;case"Digit7":return 55;case"Digit8":return 56;case"Digit9":return 57;case"Digit0":return 48;case"KeyA":return 65;case"KeyB":return 66;case"KeyC":return 67;case"KeyD":return 68;case"KeyE":return 69;case"KeyF":return 70;case"KeyG":return 71;case"KeyH":return 72;case"KeyI":return 73;case"KeyJ":return 74;case"KeyK":return 75;case"KeyL":return 76;case"KeyM":return 77;case"KeyN":return 78;case"KeyO":return 79;case"KeyP":return 80;case"KeyQ":return 81;case"KeyR":return 82;case"KeyS":return 83;case"KeyT":return 84;case"KeyU":return 85;case"KeyV":return 86;case"KeyW":return 87;case"KeyX":return 88;case"KeyY":return 89;case"KeyZ":return 90;case"F1":return 112;case"F2":return 113;case"F3":return 114;case"F4":return 115;case"F5":return 116;case"F6":return 117;case"F7":return 118;case"F8":return 119;case"F9":return 120;case"F10":return 121;case"F11":return 122;case"F12":return 123;case"ShiftLeft":return 160;case"ShiftRight":return 161;case"ControlLeft":return 162;case"ControlRight":return 163;case"AltLeft":return 164;case"AltRight":return 165;case"Enter":return 13;case"Space":return 32;case"ArrowDown":return 40;case"ArrowLeft":return 37;case"ArrowRight":return 39;case"ArrowUp":return 38;case"Escape":return 27;case"CapsLock":return 20;case"Tab":return 9;case"Insert":return 69;case"Delete":return 70;case"Numpad0":return 96;case"Numpad1":return 97;case"Numpad2":return 98;case"Numpad3":return 99;case"Numpad4":return 100;case"Numpad5":return 101;case"Numpad6":return 102;case"Numpad7":return 103;case"Numpad8":return 104;case"Numpad9":return 105;case"NumpadAdd":return 107;case"NumpadDivide":return 111;case"NumpadMultiply":return 106;case"NumpadSubtract":return 109;case"NumpadEnter":return 13}},setAspect:function(e,t){Platform.aspectW=e,Platform.aspectH=t,this.setStyle(Platform.currentStyle)},setStyle:function(e){Platform.currentStyle=e;var t=window.innerWidth,r=window.innerHeight,n=Platform.aspectW/Platform.aspectH,a=Platform.aspectH/Platform.aspectW,o=t/r;log.debug("Set Window style: "+e+"  "+Platform.aspectW+":"+Platform.aspectH+"   "+t+"x"+r);var i={},s="top:0; left:0; z-index: 0; pointer-events: all; margin: auto;";i.portrait=o<=n?s+"position: absolute; bottom: 0;right: 0;width: "+t+"px;height:"+t*a+"px;":s+"position: relative;width:"+r*n+"px;height:"+r+"px;",i.landscape=o<=n?s+"position: absolute;bottom: 0;right: 0;width:"+t+"px;height:"+t*a+"px;":s+"position: relative;width:"+r*n+"px;height:"+r+"px;",Platform.baseDiv.style.cssText=void 0!==i[e]?i[e]:s+"position: absolute;width:"+t+"px;height:"+r+"px;",Platform.applyResize()},applyResize:function(){Platform.canvas.width=Platform.canvas.clientWidth,Platform.canvas.height=Platform.canvas.clientHeight,Platform.onResizeCB(Platform.canvas.width,Platform.canvas.height),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,Platform.canvas.width,Platform.canvas.height)},doResize:function(){Platform.currentStyle&&(Platform.setStyle(Platform.currentStyle),Platform.applyResize())},initWindow:function(e){var t=document.createElement("canvas");t.id=e+"-canvas",t.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: all; display: block;",Platform.baseDiv.appendChild(t),Platform.canvas=t,Platform.canvas.width=Platform.canvas.clientWidth,Platform.canvas.height=Platform.canvas.clientHeight;var r=document.createElement("div");r.id="w4-gui",r.style.cssText="display: block; width: 100%; height: 100%; position: relative; pointer-events: none; top: 0; left: 0; margin: auto; z-index: 2;",Platform.baseDiv.appendChild(r),Platform.loader=document.getElementById("w4-loader"),Platform.baseDiv.appendChild(Platform.loader),log.trace("loader: "+Platform.loader);for(var n=[{ctx:["webgl","experimental-webgl","webkit-3d","moz-webgl"],ext:["OES_element_index_uint","OES_vertex_array_object"],init:function(){var e=gl.getExtension("OES_vertex_array_object");gl.createVertexArray=function(){return e.createVertexArrayOES()},gl.bindVertexArray=function(t){e.bindVertexArrayOES(t)},gl.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},gl.getExtension("WEBGL_depth_texture")&&(Platform.hasDepthTextures=!0,Platform.depthSupportedFormat=gl.DEPTH_COMPONENT)}},{ctx:["webgl2","experimental-webgl2"],ext:[],init:function(){Platform.hasDepthTextures=!0,Platform.depthSupportedFormat=gl.DEPTH_COMPONENT16,gl.getExtension("EXT_color_buffer_float")&&(Platform.hasFloatTextures=!0)}}],a=0,o="",i=n.length-1;i>=0;--i){for(var s=0;s<n[i].ctx.length;++s)if(gl=Platform.canvas.getContext(n[i].ctx[s],{preserveDrawingBuffer:!0,alpha:!1}),gl){for(var l=0;l<n[i].ext.length;++l){var u=n[i].ext[l];gl.getExtension(u)||fatalError("can't load extention "+u)}n[i].init(),a=i+1,o=n[i].ctx[s];break}if(gl)break}return gl?log.info("WGL inited: "+a+" : "+o):fatalError("WGL context init failed"),this.ctxVersion=a,gl.viewport(0,0,Platform.canvas.width,Platform.canvas.height),gl.enable(gl.CULL_FACE),gl.cullFace(gl.BACK),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LESS),Platform.setStyle(Platform.baseDiv.className),log.trace("Window was init successfully "+Platform.canvas.width+"x"+Platform.canvas.height),log.info("Max uniforms: "+gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS)+" | "+gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS)),log.info("Max textures: "+gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)+" | "+gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),log.info("Max varyings: "+gl.getParameter(gl.MAX_VARYING_VECTORS)),a}},w4lWindowInit:function(e,t){e=UTF8ToString(e),Platform.baseDiv=document.getElementById(e),Platform.onResizeCB=wasmTable.get(t),null!=Platform.baseDiv&&null!=Platform.baseDiv&&"DIV"==Platform.baseDiv.tagName||fatalError("Window Init: '"+e+"' is not DIV element, can't initalised W4 engine!");var r=Platform.initWindow(e);return window.onresize=Platform.doResize,r},w4HasDepthTexture:function(){return Platform.hasDepthTextures},w4HasFloatTexture:function(){return Platform.hasFloatTextures},w4lWindowSetAspect:function(e,t){log.trace("Set Window aspect : "+e+"/"+t),Platform.setAspect(e,t)},w4lWindowSetStyle:function(e){Platform.setStyle(UTF8ToString(e))},w4lLoaderSetStyle:function(e){stl=UTF8ToString(e),log.trace("Set Loader  style : "+stl),Platform.loader.classList.toggle(stl)},w4lPlatformGetDPR:function(){return window.devicePixelRatio},w4lWindowGetWidth:function(){return Platform.canvas.width},w4lWindowGetHeight:function(){return Platform.canvas.height},w4lPlatformJumpToUrl:function(e){document.location.href=UTF8ToString(e)},w4lLoaderSetVisible:function(e){null!=Platform.loader&&(Platform.loader.style.display=e?"block":"none",log.trace("Set preloader: "+Platform.loader.style.display))},w4lPlatformInit:function(e,t,r,n,a,o,i){if(null==Platform.canvas||null==Platform.canvas)fatalError("Can't Initalize Window");else{Platform.gamepadData=OuterID.get(i);var s={up:0,down:1,move:2};Platform.mousePress=new Set,window.addEventListener("blur",function(e){wasmTable.get(r)(),e.preventDefault()},!1),window.addEventListener("focus",function(e){wasmTable.get(n)(),e.preventDefault()},!1),document.addEventListener("visibilitychange",function(e){"hidden"===document.visibilityState?wasmTable.get(r)():wasmTable.get(n)(),e.preventDefault()},!1),Platform.canvas.addEventListener("webglcontextlost",function(t){wasmTable.get(e)(),t.preventDefault()},!1),Platform.canvas.addEventListener("webglcontextrestored",function(e){wasmTable.get(t)()},!1),Platform.canvas.addEventListener("mousedown",function(e){var t=Platform.getMousePos(Platform.canvas,e),r=e.hasOwnProperty("id")?e.id:0;Platform.mousePress.add(r),wasmTable.get(a)(t.x,t.y,s.down,r)},!1),Platform.canvas.addEventListener("mouseup",function(e){var t=Platform.getMousePos(Platform.canvas,e),r=e.hasOwnProperty("id")?e.id:0;Platform.mousePress.delete(r),wasmTable.get(a)(t.x,t.y,s.up,r)},!1),Platform.canvas.addEventListener("mousemove",function(e){var t=Platform.getMousePos(Platform.canvas,e),r=e.hasOwnProperty("id")?e.id:0;Platform.mousePress.has(r)&&wasmTable.get(a)(t.x,t.y,s.move,r)},!1),Platform.canvas.addEventListener("touchstart",function(e){for(var t=0;t<e.changedTouches.length;++t){var r=e.changedTouches[t],n=new MouseEvent("mousedown",{clientX:r.clientX,clientY:r.clientY});n.id=r.identifier,Platform.canvas.dispatchEvent(n)}e.preventDefault()},!1),Platform.canvas.addEventListener("touchend",function(e){for(var t=0;t<e.changedTouches.length;++t){var r=e.changedTouches[t],n=new MouseEvent("mouseup",{clientX:r.clientX,clientY:r.clientY});n.id=r.identifier,Platform.canvas.dispatchEvent(n)}e.preventDefault()},!1),Platform.canvas.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;++t){var r=e.changedTouches[t],n=new MouseEvent("mousemove",{clientX:r.clientX,clientY:r.clientY});n.id=r.identifier,Platform.canvas.dispatchEvent(n)}e.preventDefault()},!1),window.addEventListener("gamepadconnected",function(e){log.info("JS: Gamepad connected at index "+e.gamepad.index+": "+e.gamepad.id+". "+e.gamepad.buttons.length+" buttons, "+e.gamepad.axes.length+" axes."),Platform.gamePadCount++,function e(t){if(Platform.gamePadCount){var r=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(!r)return;var n=r[0];Platform.gamepadData.buttonsCount[0]=n.buttons.length,Platform.gamepadData.axesCount[0]=n.axes.length;for(var a=0;a<n.buttons.length;++a)Platform.gamepadData.buttonsState[a][0]=n.buttons[a].pressed;for(a=0;a<n.axes.length;++a)Platform.gamepadData.axesState[a][0]=n.axes[a].valueOf();self.updateCallbackId=window.requestAnimationFrame(e)}}()}),window.addEventListener("gamepaddisconnected",function(e){log.info("Gamepad disconnected from index "+e.gamepad.index+": "+e.gamepad.id),Platform.gamePadCount--});var l={Up:0,Down:1,Press:2};window.addEventListener("keydown",function(e){var t=Platform.getPlatformKeyboardCode(e.code),r=e.altKey|e.ctrlKey<<1|e.shiftKey<<2,n=l.Down;wasmTable.get(o)(t,n,r)},!1),window.addEventListener("keyup",function(e){var t=Platform.getPlatformKeyboardCode(e.code),r=e.altKey|e.ctrlKey<<1|e.shiftKey<<2,n=l.Up;wasmTable.get(o)(t,n,r)},!1)}}};autoAddDeps(LibraryPlatform,"$Platform"),mergeInto(LibraryManager.library,LibraryPlatform);var LibrarySensors={$W4_Sensors:{initSensor:function(e){var t={frequency:60};alert(JSON.stringify(t)),sensor=new RelativeOrientationSensor(t),sensor.addEventListener("reading",function(){alert(sensor),e(sensor.x,sensor.y,sensor.z)}),sensor.onerror=function(e){"NotReadableError"==e.error.name&&console.log("Sensor is not available.")},sensor.start()}},w4_sensors:function(e){navigator.permissions?Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]):(alert("No Permissions API, still try to start app."),W4_Sensors.initSensor(e))}};autoAddDeps(LibrarySensors,"$W4_Sensors"),mergeInto(LibraryManager.library,LibrarySensors);var LibraryVideoW4={$W4_Video:{create:function(e){var t=UTF8ToString(e),r=document.createElement("video");document.body.appendChild(r),r.playsInline=!0,r.style.display="none";var n=document.createElement("source");return n.src=t,r.crossOrigin="anonymous",r.appendChild(n),r.load(),OuterID.make(r)},play:function(e,t){var r=OuterID.get(e);r.play(),r.loop=t},pause:function(e){OuterID.get(e).pause()},stop:function(e){var t=OuterID.get(e);t.pause(),t.currentTime=0},setMute:function(e,t){OuterID.get(e).muted=t},getMute:function(e){return OuterID.get(e).muted},setLoop:function(e,t){OuterID.get(e).loop=t},getLoop:function(e){return OuterID.get(e).loop},setVolume:function(e,t){OuterID.get(e).volume=t},getVolume:function(e){return OuterID.get(e).volume},getWidth:function(e){return OuterID.get(e).videoWidth},getHeight:function(e){return OuterID.get(e).videoHeight},setPlaybackRate:function(e,t){OuterID.get(e).playbackRate=t},getPlaybackRate:function(e){return OuterID.get(e).playbackRate},isPlaying:function(e){return!OuterID.get(e).paused},getDuration:function(e){return OuterID.get(e).duration},setCurrentTime:function(e,t){return OuterID.get(e).currentTime=t},getCurrentTime:function(e){return OuterID.get(e).currentTime},subscribeOnEnded:function(e,t){OuterID.get(t).onended=function(){wasmTable.get(e)(t)}},unsubscribeOnEnded:function(e,t){OuterID.get(t).onended=void 0},subscribeOnCanPlay:function(e,t){OuterID.get(t).oncanplaythrough=function(){wasmTable.get(e)(t)}},unsubscribeOnCanPlay:function(e){OuterID.get(e).oncanplaythrough=void 0}},w4_create_video:function(e){return W4_Video.create(e)},w4_play_video:function(e,t){W4_Video.play(e,t)},w4_pause_video:function(e){W4_Video.pause(e)},w4_set_mute_video:function(e,t){W4_Video.setMute(e,t)},w4_get_mute_video:function(e){return W4_Video.getMute(e)},w4_set_loop_video:function(e,t){W4_Video.setLoop(e,t)},w4_get_loop_video:function(e){return W4_Video.getLoop(e)},w4_set_volume_video:function(e,t){W4_Video.setVolume(e,t)},w4_get_volume_video:function(e){return W4_Video.getVolume(e)},w4_set_current_time_video:function(e,t){W4_Video.setCurrentTime(e,t)},w4_get_current_time_video:function(e){return W4_Video.getCurrentTime(e)},w4_set_playback_rate_video:function(e,t){W4_Video.setPlaybackRate(e,t)},w4_get_playback_rate_video:function(e){return W4_Video.getPlaybackRate(e)},w4_get_duration_video:function(e){return W4_Video.getDuration(e)},w4_get_width_video:function(e){return W4_Video.getWidth(e)},w4_get_height_video:function(e){return W4_Video.getHeight(e)},w4_is_playing_video:function(e){return W4_Video.isPlaying(e)},w4_stop_video:function(e){return W4_Video.stop(e)},w4_video_subscribe_ended:function(e,t){return W4_Video.subscribeOnEnded(e,t)},w4_video_unsubscribe_ended:function(e){return W4_Video.unsubscribeOnEnded(e)},w4_video_subscribe_canplay:function(e,t){return W4_Video.subscribeOnCanPlay(e,t)},w4_video_unsubscribe_canplay:function(e){return W4_Video.unsubscribeOnCanPlay(e)}};autoAddDeps(LibraryVideoW4,"$W4_Video"),mergeInto(LibraryManager.library,LibraryVideoW4);var FacebookImpl={$Facebook:{preloadedRewardedVideo:void 0,preloadRequested:!1,videoPreloaded:!1,showRequested:!1,lastError:void 0,videoShowedCB:void 0,_sendResponse:function(e){null!=Facebook.videoShowedCB&&wasmTable.get(Facebook.videoShowedCB)(e)},_resetVideoState:function(e){Facebook.preloadedRewardedVideo=void 0,Facebook.preloadRequested=!1,Facebook.videoPreloaded=!1,Facebook.showRequested=!1,Facebook.videoShowedCB=void 0,Facebook.preloadRewardedVideo(e)},_showVideoAsync:function(e){null!=Facebook.preloadedRewardedVideo&&1==Facebook.showRequested&&Facebook.preloadedRewardedVideo.showAsync().then(function(){console.log("Rewarded video watched successfully"),Facebook._sendResponse(!0),Facebook._resetVideoState(e)}).catch(function(t){Facebook.lastError=t,console.error(t.message),Facebook._sendResponse(!1),Facebook._resetVideoState(e)})},getID:function(){return FBInstant.player.getID()},getName:function(){return FBInstant.player.getName()},getPhoto:function(){return FBInstant.player.getPhoto()},getConnectedPlayers:function(e){FBInstant.player.getConnectedPlayersAsync().then(function(t){var r=JSON.stringify(t),n=lengthBytesUTF8(r)+1,a=Module._malloc(n);stringToUTF8(r,a,n),wasmTable.get(e)(a),Module._free(a)})},logEvent:function(e,t,r){var n=FBInstant.logEvent(e,t,r);console.log(n)},preloadRewardedVideo:function(e){0==Facebook.preloadRequested&&(console.log("preloadRewardedVideo"),Facebook.preloadRequested=!0,FBInstant.getRewardedVideoAsync(e).then(function(e){return Facebook.preloadedRewardedVideo=e,Facebook.preloadedRewardedVideo.loadAsync()}).then(function(){console.log("Rewarded video preloaded"),Facebook.videoPreloaded=!0,Facebook._showVideoAsync(e)}).catch(function(e){console.error("Rewarded video failed to preload: "+e.message),Facebook.lastError=e,Facebook.preloadedRewardedVideo=void 0,Facebook.preloadRequested=!1,Facebook.videoPreloaded=!1,1==Facebook.showRequested&&(Facebook.showRequested=!1,Facebook._sendResponse(!1))}))},showRewardedVideo:function(e,t){console.log("showRewardedVideo"),Facebook.showRequested=!0,Facebook.videoShowedCB=t,Facebook.videoPreloaded?Facebook._showVideoAsync(e):0==Facebook.preloadRequested&&Facebook.preloadRewardedVideo(e)}},Facebook_getID__deps:["$Facebook"],Facebook_getID:function(){var e=Facebook.getID(),t=lengthBytesUTF8(e)+1,r=Module._malloc(t);return stringToUTF8(e,r,t),r},Facebook_getName__deps:["$Facebook"],Facebook_getName:function(){var e=Facebook.getName(),t=lengthBytesUTF8(e)+1,r=Module._malloc(t);return stringToUTF8(e,r,t),r},Facebook_getPhoto__deps:["$Facebook"],Facebook_getPhoto:function(){var e=Facebook.getPhoto(),t=lengthBytesUTF8(e)+1,r=Module._malloc(t);return stringToUTF8(e,r,t),r},Facebook_getConnectedPlayers__deps:["$Facebook"],Facebook_getConnectedPlayers:function(e){Facebook.getConnectedPlayers(e)},Facebook_getPlayerData__deps:["$Facebook"],Facebook_getPlayerData:function(e,t){var r=UTF8ToString(e).split(" ");FBInstant.player.getDataAsync(r).then(function(e){var r=JSON.stringify(e),n=lengthBytesUTF8(r)+1,a=Module._malloc(n);stringToUTF8(r,a,n),wasmTable.get(t)(a),Module._free(a)})},Facebook_makeSignedPlayerData__deps:["$Facebook"],Facebook_makeSignedPlayerData:function(e,t,r){try{var n=UTF8ToString(e);FBInstant.player.getSignedPlayerInfoAsync(n).then(function(e){var n=lengthBytesUTF8(e.getSignature())+1,a=Module._malloc(n);stringToUTF8(e.getSignature(),a,n),wasmTable.get(r)(t,a),Module._free(e)}).catch(function(e){wasmTable.get(r)(t,0)})}catch(e){wasmTable.get(r)(t,0)}},Facebook_setPlayerData__deps:["$Facebook"],Facebook_setPlayerData:function(e){var t=JSON.parse(UTF8ToString(e));FBInstant.player.setDataAsync(t).then(function(){console.log("data was sended to Facebook")})},Facebook_getLastErrorCode:function(){return"ADS_NO_FILL"==Facebook.lastError.code?1001:0},Facebook_free__deps:["$Facebook"],Facebook_free:function(e){Module._free(e)},Facebook_logEvent__deps:["$Facebook"],Facebook_logEvent:function(e,t,r){Facebook.logEvent(UTF8ToString(e),t,JSON.parse(UTF8ToString(r)))},Facebook_showRewardedVideo__deps:["$Facebook"],Facebook_showRewardedVideo:function(e,t){Facebook.showRewardedVideo(UTF8ToString(e),t)},Facebook_setSessionData__deps:["$Facebook"],Facebook_setSessionData:function(e){var t=JSON.parse(UTF8ToString(e));FBInstant.setSessionData(t)},Facebook_makeScreenshot__deps:["$Facebook"],Facebook_makeScreenshot:function(){var e=document.getElementById("w4");window.html2canvas(e,{useCORS:!0,onrendered:function(e){FBInstant.shareAsync({intent:"REQUEST",image:e.toDataURL(),text:""}).then(function(){})}})},Facebook_makeShortcut__deps:["$Facebook"],Facebook_makeShortcut:function(e){FBInstant.canCreateShortcutAsync().then(function(t){t?FBInstant.createShortcutAsync().then(function(){wasmTable.get(e)(!0)}).catch(function(){wasmTable.get(e)(!1)}):wasmTable.get(e)(!1)})},Facebook_subscribeBot__deps:["$Facebook"],Facebook_subscribeBot:function(e){FBInstant.player.canSubscribeBotAsync().then(function(t){t?FBInstant.player.subscribeBotAsync().then(function(){wasmTable.get(e)(!0)}).catch(function(){wasmTable.get(e)(!1)}):wasmTable.get(e)(!1)}).catch(function(){wasmTable.get(e)(!1)})},Facebook_requestPlatform__deps:["$Facebook"],Facebook_getPlatform:function(){switch(FBInstant.getPlatform()){case"IOS":return 1;case"ANDROID":return 2;case"WEB":return 3;case"MOBILE_WEB":return 4;default:return 0}},Facebook_preloadRewardedVideo__deps:["$Facebook"],Facebook_preloadRewardedVideo:function(e){Facebook.preloadRewardedVideo(UTF8ToString(e))},Facebook_isRewardedVideoPreloaded__deps:["$Facebook"],Facebook_isRewardedVideoPreloaded:function(){return 1==Facebook.preloadRequested||Facebook.videoPreloaded}};mergeInto(LibraryManager.library,FacebookImpl);var OKImpl={$OK__postset:'Module["OK"]=OK; ',$OK__deps:["$XHR"],$OK:{showLoadedAdContext:void 0,showLoadedAdCallback:void 0,loadAdContext:void 0,loadAdCallback:void 0,postMediatopicContext:void 0,postMediatopicCallback:void 0,askPermissionContext:void 0,askPermissionCallback:void 0,callAndClear:function(e,t,r){wasmTable.get(t)(e,r),e=null,t=null},API_callback:function(e,t,r){console.log("API_callback internal"),console.log(e,t,r),resultFlag="ok"===t,"showLoadedAd"===e&&OK.showLoadedAdCallback&&OK.showLoadedAdContext?OK.callAndClear(OK.showLoadedAdContext,OK.showLoadedAdCallback,resultFlag):"loadAd"===e&&OK.loadAdCallback&&OK.loadAdContext?OK.callAndClear(OK.loadAdContext,OK.loadAdCallback,resultFlag):"postMediatopic"===e&&OK.postMediatopicContext&&OK.postMediatopicCallback?OK.callAndClear(OK.postMediatopicContext,OK.postMediatopicCallback,resultFlag):"showPermissions"===e&&OK.askPermissionContext&&OK.askPermissionCallback?OK.callAndClear(OK.askPermissionContext,OK.askPermissionCallback,resultFlag):(console.log(t),console.log(OK.showLoadedAdContext),console.log(OK.showLoadedAdCallback),console.log(OK.loadAdContext),console.log(OK.loadAdCallback),console.log(OK.askPermissionContext),console.log(OK.askPermissionCallback),console.error("callback not found"))},callAPI:function(e){return new Promise(function(t,r){FAPI.Client.call(e,function(e,n,a){console.log("=== FAPI.Client.call ==="),console.log(e),console.log(n),console.log(a),console.log("========================"),"ok"===e?t(n):(console.error("FAPI.Client.call error: "+a),r(a))})})},getID:function(){return OK.callAPI({fields:"uid",method:"users.getCurrentUser"})},getName:function(){return OK.callAPI({fields:"first_name",method:"users.getCurrentUser"})},getPhoto:function(){return OK.callAPI({fields:"PHOTO_ID, PIC_1, PIC_2, PIC_3, PIC_4, PIC_5, PIC50X50, PIC128X128, PIC128MAX, PIC180MIN, PIC240MIN, PIC320MIN, PIC190X190, PIC640X480, PIC1024X768",method:"users.getCurrentUser"})},getAppUsers:function(){return OK.callAPI({method:"friends.getAppUsers"})},getUsersInfo:function(e){var t={method:"users.getInfo",fields:"uid, first_name, pic128x128",uids:e};return OK.callAPI(t)},loadAd:function(e,t){OK.loadAdContext=e,OK.loadAdCallback=t,FAPI.UI.loadAd()},showLoadedAd:function(e,t){OK.showLoadedAdContext=e,OK.showLoadedAdCallback=t,FAPI.UI.showLoadedAd()},getUploadUrl:function(){return OK.callAPI({method:"photosV2.getUploadUrl"})},checkPermission:function(e,t,r){console.log("checkPermission"),console.log(r);var n={method:"users.hasAppPermission",ext_perm:r};OK.callAPI(n).then(function(r){console.log("check permission -> then"),console.log(r),wasmTable.get(t)(e,r)}).catch(function(r){console.error("check permission -> catch"),console.error(r),wasmTable.get(t)(e,!1)})},askPermission:function(e,t,r){console.log("askPermission"),r='["'+r+'"]',console.log(r),OK.askPermissionContext=e,OK.askPermissionCallback=t,FAPI.UI.showPermissions(r)},postMediatopic:function(e,t){var r=document.getElementById("w4");window.html2canvas(r,{useCORS:!0,onrendered:function(r){OK.getUploadUrl().then(function(n){console.log("OK.getUploadUrl() -> then"),console.log(n);var a=n.upload_url,o=n.photo_ids[0];r.toBlob(function(r){console.log("canvas.toBlob"),console.log(r);var n=new FormData;n.append("pic",r),XHR.post(a,"multipart/form-data",n).then(function(r){console.log("XHR.post -> then");var n=JSON.parse(r),a=n.photos[o].token;console.log(n.photos[o].token),OK.postMediatopicContext=e,OK.postMediatopicCallback=t,FAPI.UI.postMediatopic({media:[{type:"photo",list:[{id:a}]}]},!1)}).catch(function(r){console.error("XHR.post -> catch"),console.error(r),OK.handleData(e,t,r)})})}).catch(function(r){console.error("OK.getUploadUrl() -> catch"),console.error(r),OK.handleData(e,t,r)})}})},suggestDesktopIcon:function(e,t){console.log(window),console.log(window.OKApp);var r=window.OKApp;r&&r.suggestDesktopIcon&&r.suggestDesktopIcon(),wasmTable.get(t)(e,!0)},handleData:function(e,t,r){void 0===r&&(r="");var n=lengthBytesUTF8(r)+1,a=Module._malloc(n);stringToUTF8(r,a,n),wasmTable.get(t)(e,a),Module._free(a)}},OK_getID__deps:["$OK"],OK_getID:function(e,t){OK.getID().then(function(r){OK.handleData(e,t,r.uid)}).catch(function(r){OK.handleData(e,t,r)})},OK_getName__deps:["$OK"],OK_getName:function(e,t){OK.getName().then(function(r){OK.handleData(e,t,r.first_name)}).catch(function(r){OK.handleData(e,t,r)})},OK_getPhoto__deps:["$OK"],OK_getPhoto:function(e,t){OK.getPhoto().then(function(r){OK.handleData(e,t,r.pic128x128)}).catch(function(r){OK.handleData(e,t,r)})},OK_getAppUsers__deps:["$OK"],OK_getAppUsers:function(e,t){OK.getAppUsers().then(function(r){console.log("data:",r),r&&r.uids&&r.uids.length?OK.getUsersInfo(r.uids).then(function(r){OK.handleData(e,t,JSON.stringify(r))}):OK.handleData(e,t,null)}).catch(function(r){OK.handleData(e,t,r)})},OK_loadAd__deps:["$OK"],OK_loadAd:function(e,t){OK.loadAd(e,t)},OK_showLoadedAd__deps:["$OK"],OK_showLoadedAd:function(e,t){OK.showLoadedAd(e,t)},OK_postMediatopic__deps:["$OK"],OK_postMediatopic:function(e,t){OK.postMediatopic(e,t)},OK_checkPermission__deps:["$OK"],OK_checkPermission:function(e,t,r){OK.checkPermission(e,t,UTF8ToString(r))},OK_askPermission__deps:["$OK"],OK_askPermission:function(e,t,r){OK.askPermission(e,t,UTF8ToString(r))},OK_suggestDesktopIcon__deps:["$OK"],OK_suggestDesktopIcon:function(e,t){OK.suggestDesktopIcon(e,t)},OK_free:function(e){Module._free(e)}};mergeInto(LibraryManager.library,OKImpl);var VkImpl={$vk:{helpers:{parseParameters:function(){var e={};function t(e){switch(e){case 0:return"RU";case 1:return"UK";case 2:return"BE";case 3:return"EN";default:return null}}function r(e){var t=parseInt(e,10);return 0===t?null:t}window.location.search.substr(1).split("&").forEach(function(t){var r=t.split("=");e[r[0]]=decodeURIComponent(r[1])}),vk.parameters.api_url=e.api_url||null,vk.parameters.app_id=parseInt(e.api_id,10),vk.parameters.user_id=parseInt(e.viewer_id,10),vk.access_token.access_token=e.access_token,vk.access_token.scope=parseInt(e.api_settings,10),vk.access_token.expires=Date.now()+86400,vk.parameters.install_owner_user_id=r(e.user_id),vk.parameters.install_owner_group_id=r(e.group_id),vk.parameters.user_install_app=Boolean(1===parseInt(e.is_app_user,10)),vk.parameters.auth_key=e.auth_key,vk.parameters.language_id=parseInt(e.language,10),vk.parameters.language=t(vk.parameters.language_id),vk.parameters.parent_language_id=parseInt(e.parent_language,10),vk.parameters.parent_language=t(vk.parameters.parent_language_id),vk.parameters.api_result=e.api_result,vk.parameters.is_secure=Boolean(1===parseInt(e.is_secure,10)),vk.parameters.referrer=e.referrer,vk.parameters.hash=e.hash,vk.parameters.is_play_machine=Boolean(1===parseInt(e.is_play_machine,10)),log.info("app_id: "+vk.parameters.app_id),log.info("user_id: "+vk.parameters.user_id),log.info("language: "+vk.parameters.language),log.info("parent_language: "+vk.parameters.parent_language),log.info("access_token scope: "+vk.helpers.scopeToString(vk.access_token.scope))},detectPlatform:function(){if(null===vk.parameters.api_url)throw vk.platform.string="undefined",vk.platform.isAndroid=!1,vk.platform.isIos=!1,vk.platform.isWeb=!1,"vk platform is undefined";vk.platform.isAndroid=Boolean(window&&window.AndroidBridge),vk.platform.isIos=Boolean(window&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.VKWebAppClose),vk.platform.isWeb=!vk.platform.isIos&&!vk.platform.isAndroid,vk.platform.isAndroid?vk.platform.string="android":vk.platform.isIos?vk.platform.string="ios":vk.platform.string="web",log.info('vk platform is "'+vk.platform.string+'"')},loadScript:function(e){return new Promise(function(t,r){try{var n=document.createElement("script");n.setAttribute("src",e),n.setAttribute("charSet","utf-8"),n.setAttribute("type","text/javascript"),n.addEventListener("load",function(){log.trace("script loaded success: "+e),t()}),n.addEventListener("error",function(){log.error("script not loaded: ",e),r(-1)}),document.head.appendChild(n)}catch(t){log.error("script not loaded ("+t+"): "+e),r(-1)}})},allocateCString:function(e){var t=lengthBytesUTF8(e)+1,r=Module._malloc(t);return stringToUTF8(e,r,t),r},freeCString:function(e){Module._free(e)},scopeToNumber:function(e){if("number"==typeof e||e instanceof Number)return e;if("string"==typeof e||e instanceof String)e=e.split(",");else if("array"!=typeof e&&!(e instanceof Array))throw"unexpected scope type ["+typeof e+"] "+e;var t=0;return e.forEach(function(e){if(!(e in vk.helpers.userScopes))throw"unexpected scope entry: "+e;t+=vk.helpers.userScopes[e]}),t},scopeToString:function(e){if("string"==typeof e||e instanceof String)return e;if("array"==typeof e||e instanceof Array)return e.join(",");if("number"==typeof e||e instanceof Number){var t=[];for(var r in vk.helpers.userScopes)e&vk.helpers.userScopes[r]&&t.push(r);return t.join(",")}throw"unexpected scope type ["+typeof e+"] "+e},checkExistsTokenNotExpired:function(){return vk.access_token.expires-Date.now()>300},checkExistsTokenScopes:function(e){for(var t in vk.helpers.userScopes){var r=vk.helpers.userScopes[t];if(Boolean(e&r)&&!Boolean(vk.access_token.scope&r))return log.debug('current access token does not have access rights to requested scope "'+t+'"'),!1}return!0},mergeWithExistsTokenScopes:function(e){var t=vk.helpers.scopeToNumber(e),r=0;for(var n in vk.helpers.userScopes){var a=vk.helpers.userScopes[n],o=(t&a)>0,i=(vk.access_token.scope&a)>0;(o||i)&&(r+=a)}return r},userScopes:{friends:2,photos:4,video:16,stories:64,pages:128,status:1024,notes:2048,wall:8192,docs:1<<17,groups:1<<18,stats:1<<20,market:1<<27},makeSafePromise:function(e){return new Promise(function(t,r){try{e(t,r)}catch(e){log.error(e),r(1)}})},makeStubPromise:function(){return new Promise(function(e){e()})},makeScreenshot:function(){return vk.helpers.makeSafePromise(function(e,t){(window.html2canvas?vk.helpers.makeStubPromise():vk.helpers.loadScript("https://html2canvas.hertzen.com/dist/html2canvas.min.js")).then(function(){window.html2canvas(document.getElementById("w4"),{useCORS:!0}).then(function(t){t.toBlob(e,"image/jpeg")}).catch(vk.helpers.catchPromise(t))}).catch(vk.helpers.catchPromise(t))})},catchPromise:function(e){return function(t){"number"==typeof t?e(t):(log.error(t),e(1))}}},parameters:{api_version:"5.130",test_mode:!1,cors_proxy:""},platform:{},access_token:{},sdk:null,adsStub:{showRewardedVideo:function(){return new Promise(function(e,t){t(-1)})},preloadRewardedVideo:function(){return new Promise(function(e,t){t(-1)})}},bridge:{makeSdk:function(e){for(var t in vk.sdk={callApi:vk.bridge.callApi,addToFavorites:vk.bridge.addToFavorites,addToHomeScreen:vk.bridge.addToHomeScreen,shareScreenshot:vk.bridge.shareScreenshot,getStorageKeys:vk.bridge.getStorageKeys,getStorageValues:vk.bridge.getStorageValues,setStorageValue:vk.bridge.setStorageValue,subscribeToGroup:vk.bridge.subscribeToGroup,joinToGroup:vk.bridge.joinToGroup},e||(e=vk.adsStub),e)vk.sdk[t]=e[t]},init:function(){return vk.helpers.makeSafePromise(function(e,t){log.trace("vk.bridge initialization start"),vk.helpers.loadScript("https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js").then(function(){var r=setTimeout(function(){log.error("VK: bridge init timeout"),t(-2)},5e3);vkBridge.send("VKWebAppInit").then(function(){if(log.trace("VK: bridge init success"),vkBridge.isWebView())log.debug("vk.ads: use native ads"),vk.bridge.makeSdk({preloadRewardedVideo:vk.bridge.preloadRewardedVideo,showRewardedVideo:vk.bridge.showRewardedVideo}),e(!0);else{if(!vkBridge.isIframe())return log.error("vk.ads: not supported"),vk.bridge.makeSdk(),void e(!1);log.debug("vk.ads: use adman"),vk.adman.init().then(function(){vk.bridge.makeSdk({preloadRewardedVideo:vk.adman.preloadRewardedVideo,showRewardedVideo:vk.adman.showRewardedVideo}),e(!0)}).catch(function(t){log.error("vk.ads: adman init error"),log.error(t),vk.bridge.makeSdk(),e(!1)})}}).catch(function(e){log.error("vk.bridge: init failure(exception)"),log.error(e),t(-1)}).finally(function(){clearTimeout(r)})})})},send:function(e,t,r){return vk.helpers.makeSafePromise(function(n,a){(r?vk.bridge.requestAccessToken(r):vk.helpers.makeStubPromise()).then(function(){(t=t||{}).params&&"access_token"in t.params&&(t.params.access_token=vk.access_token.access_token),vk.parameters.test_mode&&(t.test_mode=1),vkBridge.supports(e)?vkBridge.send(e,t).then(function(e){n(e)},function(r){log.error('vk.bridge.send: method "'+e+'" failure'),log.error("input parameters:"),log.error(t),log.error("error response:"),log.error(r),a(r.error_data.error_code)}).catch(function(r){log.error('vk.bridge.send: method "'+e+'" throw exception'),log.error("input parameters:"),log.error(t),log.error("exception:"),log.error(r),a(1)}):(log.error('vk.bridge.send: method "'+e+'" is not supported'),a(23))},a)})},requestAccessToken:function(e){return vk.helpers.makeSafePromise(function(t,r){log.trace("request access token: "+e),!e||0===e||vk.helpers.checkExistsTokenScopes(e)&&vk.helpers.checkExistsTokenNotExpired()?(log.trace("use current access token"),t(vk.access_token.access_token)):vk.bridge.send("VKWebAppGetAuthToken",{app_id:vk.parameters.app_id,scope:vk.helpers.scopeToString(vk.helpers.mergeWithExistsTokenScopes(e))}).then(function(n){log.trace("access token received"),vk.access_token.access_token=n.access_token,vk.access_token.expires=n.expires||Date.now()+86400,n.scope?(vk.access_token.scope=vk.helpers.scopeToNumber(n.scope),vk.helpers.checkExistsTokenScopes(e)?t():(log.error("user does not give access to all required scopes"),r(4))):(vk.access_token.scope=vk.helpers.scopeToNumber(e),t())}).catch(vk.helpers.catchPromise(r))})},callApi:function(e,t,r){return vk.helpers.makeSafePromise(function(n,a){"access_token"in t&&(t.access_token=vk.access_token.access_token),t.v=vk.parameters.api_version,vk.bridge.send("VKWebAppCallAPIMethod",{method:e,params:t},r).then(function(e){n(e.response)}).catch(vk.helpers.catchPromise(a))})},preloadRewardedVideo:function(){return vk.helpers.makeStubPromise()},showRewardedVideo:function(){return vk.helpers.makeSafePromise(function(e,t){vk.bridge.send("VKWebAppShowNativeAds",{ad_format:"reward"}).then(function(t){log.debug("VK.bridge rewarded video result: "+(t.result?"show":"not show")),e(t.result)}).catch(vk.helpers.catchPromise(t))})},addToFavorites:function(){return vk.helpers.makeSafePromise(function(e,t){vk.bridge.send("VKWebAppAddToFavorites",{}).then(function(r){r.result?(log.debug("VK.bridge.addToFavorites result: success"),e()):(log.error("VK.bridge.addToFavorites result: rejected by user"),t(1))}).catch(vk.helpers.catchPromise(t))})},addToHomeScreen:function(){return vk.helpers.makeSafePromise(function(e,t){vk.bridge.send("VKWebAppAddToHomeScreenInfo",{}).then(function(r){r.is_added_to_home_screen?(log.debug("VK.bridge.addToHomeScreen: already added"),e()):r.is_feature_supported?vk.bridge.send("VKWebAppAddToHomeScreen",{}).then(function(r){r.result?(log.debug("VK.bridge.addToHomeScreen result: success"),e()):(log.error("VK.bridge.addToHomeScreen result: rejected by user"),t(4))}).catch(vk.helpers.catchPromise(t)):(log.error("VK.bridge.addToHomeScreen: not supported"),t(1))}).catch(vk.helpers.catchPromise(t))})},shareScreenshot:function(e,t){return vk.helpers.makeSafePromise(function(r,n){vk.bridge.callApi("photos.getWallUploadServer",{access_token:null},"photos").then(function(a){a.album_id;var o=a.upload_url;vk.helpers.makeScreenshot().then(function(a){var i=new FormData;i.append("photo",a,"photo.jpg");var s=new XMLHttpRequest;s.open("POST",vk.parameters.cors_proxy+o,!0),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var a=JSON.parse(s.responseText);vk.bridge.callApi("photos.saveWallPhoto",{user_id:vk.parameters.user_id,photo:a.photo,server:a.server,hash:a.hash,access_token:null},"photos").then(function(a){vk.bridge.send("VKWebAppShowWallPostBox",{message:e,attachments:"photo"+a[0].owner_id+"_"+a[0].id+",https://vk.com/app"+t},"wall").then(function(e){log.info("post on wall success, post_id: "+e.post_id),r()}).catch(vk.helpers.catchPromise(n))}).catch(vk.helpers.catchPromise(n))}else log.error("unable to upload screenshot to server"),n(1)},s.send(i)}).catch(vk.helpers.catchPromise(n))}).catch(vk.helpers.catchPromise(n))})},getStorageKeys:function(e,t){return vk.helpers.makeSafePromise(function(r,n){vk.bridge.send("VKWebAppStorageGetKeys",{count:e,offset:t}).then(function(e){r(e.keys)}).catch(vk.helpers.catchPromise(n))})},setStorageValue:function(e,t){return vk.helpers.makeSafePromise(function(r,n){if("string"!=typeof e&&!(e instanceof String))return log.error("vk.bridge.setStorageValue: key must be string"),void n(8);if(e.length>100)return log.error("vk.bridge.setStorageValue: key length must be not great then 100"),void n(8);if(t){if("string"!=typeof t&&!(t instanceof String))return log.error("vk.bridge.setStorageValue: value must be string"),void n(8);if(e.length>4096)return log.error("vk.bridge.setStorageValue: key length must be not great then 4096"),void n(8)}vk.bridge.send("VKWebAppStorageSet",{key:e,value:t}).then(function(t){t.result?r():(log.error('vk.bridge.setStorageValue: unable to update value of "'+e+'"'),n(1))}).catch(vk.helpers.catchPromise(n))})},getStorageValues:function(e){return vk.helpers.makeSafePromise(function(t,r){if("string"==typeof e||e instanceof String)e=[e];else if("array"!=typeof e&&!(e instanceof Array))return log.error("vk.bridge.getStorageValue: keys must be string or array of string"),void r(8);e.forEach(function(e){return"string"==typeof e||e instanceof String?e.length>100?(log.error("vk.bridge.getStorageValue: key length must be not great then 100"),void r(8)):void 0:(log.error("vk.bridge.getStorageValue: key must be string"),void r(8))}),vk.bridge.send("VKWebAppStorageGet",{keys:e}).then(function(e){t(e.keys)}).catch(vk.helpers.catchPromise(r))})},subscribeToGroup:function(e,t){return vk.helpers.makeSafePromise(function(r,n){vk.bridge.send("VKWebAppAllowMessagesFromGroup",{group_id:e,key:t}).then(function(e){e.result?r():(log.error("user not accept subscription to group"),n(4))}).catch(vk.helpers.catchPromise(n))})},joinToGroup:function(e){return vk.helpers.makeSafePromise(function(t,r){vk.bridge.send("VKWebAppJoinGroup",{group_id:e}).then(function(e){e.result?t():(log.error("user not accept join to group"),r(4))}).catch(vk.helpers.catchPromise(r))})}},adman:{preloadedVideo:null,preloadVideoStatusEnum:{idle:0,inProgress:1,complete:2},preloadVideoCallback:[],init:function(){return new Promise(function(e,t){vk.helpers.loadScript("//ad.mail.ru/static/admanhtml/rbadman-html5.min.js").then(function(){vk.helpers.loadScript("//vk.com/js/api/adman_init.js").then(function(){vk.adman.preloadVideoStatus=vk.adman.preloadVideoStatusEnum.idle,e()},t)},t)})},preloadRewardedVideo:function(){return vk.helpers.makeSafePromise(function(e,t){switch(vk.adman.preloadVideoStatus){case vk.adman.preloadVideoStatusEnum.idle:vk.adman.preloadVideoStatus=vk.adman.preloadVideoStatusEnum.inProgress,vk.adman.preloadVideoCallback.push({resolve:e,reject:t});var r=setTimeout(function(){log.error("vk.adman preload rewarded video timeout"),vk.adman.preloadVideoStatus=vk.adman.preloadVideoStatusEnum.idle;var e=vk.adman.preloadVideoCallback;vk.adman.preloadVideoCallback=[],e.forEach(function(e){e.reject(-2)})},5e3);admanInit({user_id:vk.parameters.user_id,app_id:vk.parameters.app_id,type:"rewarded",params:{preview:1}},function(e){log.debug("vk.adman preload rewarded video success"),clearTimeout(r),vk.adman.preloadVideoStatus=vk.adman.preloadVideoStatusEnum.complete,vk.adman.preloadedVideo=e;var t=vk.adman.preloadVideoCallback;vk.adman.preloadVideoCallback=[],t.forEach(function(e){e.resolve(!0)})},function(){log.debug("vk.adman preload rewarded video failure: no video"),vk.adman.preloadVideoStatus=vk.adman.preloadVideoStatusEnum.idle,clearTimeout(r);var e=vk.adman.preloadVideoCallback;vk.adman.preloadVideoCallback=[],e.forEach(function(e){e.resolve(!1)})});break;case vk.adman.preloadVideoStatusEnum.inProgress:vk.adman.preloadVideoCallback.push({resolve:e,reject:t});break;case vk.adman.preloadVideoStatusEnum.complete:e();break;default:log.error("unexpected preload video status"),t(1)}})},showRewardedVideo:function(){return vk.helpers.makeSafePromise(function(e,t){vk.adman.preloadRewardedVideo().then(function(){if(null===vk.adman.preloadedVideo)return log.warning("vk.adman: duplicate rewarded video request"),void t(6);var r=vk.adman.preloadedVideo;vk.adman.preloadedVideo=null,r.onCompleted(function(){e(!0)}),r.onSkipped(function(){e(!1)}),r.start("preroll")},t)})}},init:function(){return vk.helpers.makeSafePromise(function(e,t){vk.helpers.parseParameters(),vk.helpers.detectPlatform(),"undefined"===vk.platform?t(-1):vk.bridge.init().then(function(t){log.info("vk.bridge initialized (ads : "+Boolean(t)+")"),e(t)},function(){log.error("vk.bridge initialization error"),t(-1)})})}},VK_initialize__deps:["$vk"],VK_initialize:function(e){vk.init().then(function(t){var r=vk.helpers.allocateCString(vk.platform.string),n=vk.helpers.allocateCString(vk.parameters.auth_key);wasmTable.get(e)(!0,t,vk.parameters.user_id,r,n),vk.helpers.freeCString(n),vk.helpers.freeCString(r)},function(){wasmTable.get(e)(!1,!1,0,0,0)})},VK_enableTestMode__deps:["$vk"],VK_enableTestMode:function(e){vk.parameters.test_mode=Boolean(0!==e)},VK_callApi__deps:["$vk"],VK_callApi:function(e,t,r,n,a,o){vk.sdk.callApi(UTF8ToString(e),JSON.parse(UTF8ToString(t)),r).then(function(e){var t=vk.helpers.allocateCString(JSON.stringify(e));wasmTable.get(n)(t,o),vk.helpers.freeCString(t)},function(e){wasmTable.get(a)(e,o)})},VK_preloadRewardedVideo__deps:["$vk"],VK_preloadRewardedVideo:function(e,t,r){vk.sdk.preloadRewardedVideo().then(function(){wasmTable.get(e)(r)},function(e){wasmTable.get(t)(e,r)})},VK_showRewardedVideo__deps:["$vk"],VK_showRewardedVideo:function(e,t,r){log.debug("show rewarded video request"),vk.sdk.showRewardedVideo().then(function(t){wasmTable.get(e)(t,r)},function(e){wasmTable.get(t)(e,r)})},VK_shareScreenshot__deps:["$vk"],VK_shareScreenshot:function(e,t,r,n,a){vk.sdk.shareScreenshot(UTF8ToString(e),UTF8ToString(t)).then(function(){wasmTable.get(r)(a)},function(e){wasmTable.get(n)(e,a)})},VK_addToFavorites__deps:["$vk"],VK_addToFavorites:function(e,t,r){vk.sdk.addToFavorites().then(function(){wasmTable.get(e)(r)},function(e){wasmTable.get(t)(e,r)})},VK_addToHomeScreen__deps:["$vk"],VK_addToHomeScreen:function(e,t,r){vk.sdk.addToHomeScreen().then(function(){wasmTable.get(e)(r)},function(e){wasmTable.get(t)(e,r)})},VK_setStorageValue__deps:["$vk"],VK_setStorageValue:function(e,t,r,n,a){vk.sdk.setStorageValue(UTF8ToString(e),UTF8ToString(t)).then(function(){wasmTable.get(r)(a)},function(e){wasmTable.get(n)(e,a)})},VK_getStorageValues__deps:["$vk"],VK_getStorageValues:function(e,t,r,n){vk.sdk.getStorageValues(JSON.parse(UTF8ToString(e))).then(function(e){var r=vk.helpers.allocateCString(JSON.stringify(e));wasmTable.get(t)(r,n),vk.helpers.freeCString(r)},function(e){wasmTable.get(r)(e,n)})},VK_getStorageKeys__deps:["$vk"],VK_getStorageKeys:function(e,t,r,n,a){vk.sdk.getStorageKeys(e,t).then(function(e){var t=vk.helpers.allocateCString(JSON.stringify(e));wasmTable.get(r)(t,a),vk.helpers.freeCString(t)},function(e){wasmTable.get(n)(e,a)})},VK_setCorsProxy:function(e){vk.parameters.cors_proxy=UTF8ToString(e)},VK_subscribeToGroup:function(e,t,r,n,a){vk.sdk.subscribeToGroup(e,UTF8ToString(t)).then(function(){wasmTable.get(r)(a)},function(e){wasmTable.get(n)(e,a)})},VK_joinToGroup:function(e,t,r,n){vk.sdk.joinToGroup(e).then(function(){wasmTable.get(t)(n)},function(e){wasmTable.get(r)(e,n)})}};mergeInto(LibraryManager.library,VkImpl);var LibraryW4_GUI={$W4_GUI_Button__postset:'W4_GUI.registerWidgetClass("Widget_Button", W4_GUI_Button);',$W4_GUI_Button:{create:function(e,t){if(W4_GUI.isValid()){var r=document.createElement("div");r.innerText="None",r.style.position="absolute",r.style.display="none",r.style.pointerEvents="auto",r.style.userSelect="none",r.style.margin="0";var n=W4_GUI.addElement(r),a=OuterID.get(e);if(a){var o=OuterID.get(t);r.widgetPOD=o,r.buttonPOD=a}return n}return console.error("W4_GUI.board not found!!!"),0},update:function(e){var t=OuterID.get(e);if(t){var r=t.buttonPOD;if(r){t.innerText=UTF8ToString(r.text[0]);var n=W4_GUI.getVirtualSize(),a=W4_GUI.getScreenSize(),o=r.fontSize[0]/n.height*a.height,i=(r.lineHeight[0],n.height,a.height,o/5);t.style.textAlign="center",t.style.fontSize=o+"px",t.style.fontFamily=UTF8ToString(r.font[0]),t.style.color=W4_GUI.toColor(r.fontColor[0]),t.style.borderRadius="1em",t.style.padding="0.5em 1em",t.style.boxSizing="border-box",r.fontBold[0]?t.style.fontWeight="bold":t.style.fontWeight="normal",r.fontItalic[0]?t.style.fontStyle="italic":t.style.fontStyle="normal";var s="w4"+e.toString();t.id=s,t.style.zIndex=t.widgetPOD.zOrder[0].toString(),1==t.widgetPOD.visible[0]?t.style.display="block":t.style.display="none";var l={x:t.widgetPOD.size[0],y:t.widgetPOD.size[1]},u=(W4_GUI.toNormalizeCoord(l,W4_GUI.virtualSize),0),d=0;switch(t.widgetPOD.verticalAlign[0]){case 1:d=50;break;case 2:d=100}switch(t.widgetPOD.horizontalAlign[0]){case 1:u=50;break;case 2:u=100}var c="auto";1==t.widgetPOD.horizontalSize[0]&&(c=t.widgetPOD.size[0]/n.width*a.width+"px");var g="auto";1==t.widgetPOD.verticalSize[0]&&(g=t.widgetPOD.size[1]/n.height*a.height+"px"),t.style.width=c,t.style.height=g;var f=t.clientWidth,_=t.clientHeight,p=(n=W4_GUI.getVirtualSize(),-f/(a=W4_GUI.getScreenSize()).width*u),m=-_/a.height*d,h={x:t.widgetPOD.position[0],y:t.widgetPOD.position[1]},v=W4_GUI.toNormalizeCoord(h,W4_GUI.getVirtualSize());t.style.left=(v.x+p)/100*a.width+"px";var b=(v.y+m)/100*a.height;t.style.opacity=t.widgetPOD.opacity[0].toString(),addStylesheetRules([["#"+s,["background",W4_GUI.toColor(r.bgColor[0])],["top",b+"px"]],["#"+s+":active",["background",W4_GUI.toDarkenColor(r.bgColor[0],10)],["top",b+i+"px"]]])}}},remove:function(e){W4_GUI.removeElement(e)},onTap:function(e,t){var r=W4_GUI.findElement(e);r&&(r.onTap&&(r.removeEventListener("click",r.onTap),r.onTap=void 0),t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTap=function(){W4_GUI.onEvent(e,W4_GUI.Event.Tap)},r.addEventListener("click",r.onTap)):(r.style.pointerEvents="none",r.style.userSelect="none"))}},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_create_button:function(e,t){return W4_GUI_Button.create(e,t)}};autoAddDeps(LibraryW4_GUI,"$W4_GUI_Button"),mergeInto(LibraryManager.library,LibraryW4_GUI);LibraryW4_GUI={$W4_GUI_Checkbox__postset:'W4_GUI.registerWidgetClass("Widget_Checkbox", W4_GUI_Checkbox);',$W4_GUI_Checkbox:{create:function(e,t,r,n){if(W4_GUI.isValid()){document.createElement("label");var a=document.createElement("span");a.style.position="absolute",a.style.pointerEvents="auto";var o=W4_GUI.addElement(a),i="w4"+o.toString();a.id=i,a.spanID=i;var s=OuterID.get(e);if(s){var l=OuterID.get(t);a.widgetPOD=l,a.checkboxPOD=s}return a.addEventListener("click",function(){wasmTable.get(n)(r,!a.checkboxPOD.checked[0])}),o}return console.error("W4_GUI.board not found!!!"),0},update:function(e){var t=OuterID.get(e);if(t){var r=t.checkboxPOD;if(r){W4_GUI.getVirtualSize();var n=W4_GUI.getScreenSize();t.style.zIndex=t.widgetPOD.zOrder[0].toString(),1==t.widgetPOD.visible[0]?t.style.display="block":t.style.display="none";var a={x:t.widgetPOD.size[0],y:t.widgetPOD.size[1]},o=0,i=0;switch(t.widgetPOD.verticalAlign[0]){case 1:i=50;break;case 2:i=100}switch(t.widgetPOD.horizontalAlign[0]){case 1:o=50;break;case 2:o=100}W4_GUI.getVirtualSize(),n=W4_GUI.getScreenSize();var s=W4_GUI.toNormalizeCoord(a,W4_GUI.getVirtualSize());t.style.width=n.width*s.x/100+"px",t.style.height=n.height*s.y/100+"px",t.style["border-radius"]=n.height*s.y/100/2+"px",t.style["max-width"]=t.style.width,t.style["max-height"]=t.style.height;var l=t.clientWidth,u=t.clientHeight,d=-l/n.width*o,c=-u/n.height*i,g={x:t.widgetPOD.position[0],y:t.widgetPOD.position[1]},f=W4_GUI.toNormalizeCoord(g,W4_GUI.getVirtualSize());t.style.left=(f.x+d)/100*n.width+"px",t.style.top=(f.y+c)/100*n.height+"px",t.style.opacity=t.widgetPOD.opacity[0].toString();t.style;var _="#"+t.spanID+"::before";addStylesheetRules([[_,["content","attr(data-off)"],["position","absolute"],["top","0"],["left","0"],["bottom","0"],["right","0"],["background-color","#cfcfcf, #f0f0f0"],["background-image","linear-gradient(to bottom, "+W4_GUI.toColor(r.fgTop[0])+", "+W4_GUI.toColor(r.fgBottom[0])+"), linear-gradient(to bottom,"+W4_GUI.toColor(r.bgTop[0])+", "+W4_GUI.toColor(r.bgBottom[0])+")"],["background-repeat","no-repeat, no-repeat"],["background-size",l+"px"+u+"px,"+l+"px"+u+"px"],["background-position",-l+"px 0, 0 0"],["border","1px solid #cccccc"],["border-radius",n.height*s.y/100/2+"px"],["transition","background-position 0.1s ease-in-out"],["outline","none"],["overflow","hidden"],["cursor","pointer"]]]),addStylesheetRules([["#"+t.spanID+"::after",["content","attr(data-off)"],["position","absolute"],["left","0"],["top","-1"],["width",u],["height",u],["transition","left 0.1s ease-in-out"],["background-color","#f5f5f5"],["background-image","linear-gradient(to bottom, white, #e6e6e6)"],["background-repeat","repeat-x"],["border","1px solid #999999"],["border-radius",n.height*s.y/100/2+"px"]]]),t.checkboxPOD.checked[0]?(addStylesheetRules([["#"+t.spanID+"::before",["color","white"],["background-position","0 0, "+l+"px 0"]]]),addStylesheetRules([["#"+t.spanID+"::after",["left",l-u+"px"]]])):(addStylesheetRules([["#"+t.spanID+"::before",["background-position",-l+"px 0, 0 0"]]]),addStylesheetRules([["#"+t.spanID+"::after",["left","0"]]]))}}},remove:function(e){W4_GUI.removeElement(e)}},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_create_checkbox:function(e,t,r,n){return W4_GUI_Checkbox.create(e,t,r,n)}};autoAddDeps(LibraryW4_GUI,"$W4_GUI_Checkbox"),mergeInto(LibraryManager.library,LibraryW4_GUI);LibraryW4_GUI={$W4_GUI_Combobox__postset:'W4_GUI.registerWidgetClass("Widget_ComboBox", W4_GUI_Combobox); document.addEventListener("click", W4_GUI_Combobox.closeAllSelect);',$W4_GUI_Combobox:{selectItems:[],selectSelected:[],comboBoxes:[],create:function(e,t,r,n){if(W4_GUI.isValid()){var a=document.createElement("div");a.style.position="absolute",a.style.display="none",a.style.pointerEvents="auto",a.style.userSelect="none",a.items=[],a.selectedIndex=-1;var o=W4_GUI.addElement(a);a.widgetID=o;var i=OuterID.get(t);a.widgetPOD=i,a.comboBoxPOD=OuterID.get(e);var s="w4"+o.toString();return a.id=s,a.ctx=r,a.valueChangedCB=n,a.defaultText=document.createElement("div"),a.defaultText.className=a.id+"_select-item",a.defaultText.innerText=UTF8ToString(a.comboBoxPOD.text[0]),a.defaultText.style.opacity="0",a.selectedDiv=document.createElement("div"),a.selectedDiv.className=a.id+"_select-selected",a.isSelectMode=!1,a.appendChild(a.selectedDiv),this.comboBoxes.push(a),a.selectedDiv.addEventListener("click",function(e){e.stopPropagation(),W4_GUI_Combobox.closeAllSelect(a),a.items.length>0?W4_GUI_Combobox.setSelectMode(a,!a.isSelectMode):W4_GUI_Combobox.setSelectMode(a,!1)}),o}return console.error("W4_GUI.board not found!!!"),0},addItem:function(e,t){this.insertItem(e,-1,t)},removeItem:function(e,t){var r=OuterID.get(e);if(r){var n=r.selectedIndex==t;r.removeChild(r.items[t]),r.items.splice(t,1),t<r.selectedIndex&&--r.selectedIndex,n&&(r.items.length>0?this.setSelectedItem(e,0):this.setSelectedItem(e,-1),this.setSelectMode(r,!1))}},setSelectedItem:function(e,t){var r=OuterID.get(e);if(r){if(r.items.length>0)if(-1!=r.selectedIndex)(n=r.items[r.selectedIndex]).classList.remove(r.id+"_same-as-selected"),n.innerText=r.selectedDiv.innerText;if(-1==t)r.selectedIndex=t,r.selectedDiv.innerText=r.defaultText.innerText;else{var n=r.items[t];r.selectedIndex=t,r.selectedDiv.innerText=n.innerText,n.innerText=r.defaultText.innerText,n.classList.add(r.id+"_same-as-selected")}wasmTable.get(r.valueChangedCB)(r.ctx,r.selectedIndex)}},insertItem:function(e,t,r){var n=OuterID.get(e);if(n){var a=document.createElement("div");if(a.innerText=r,a.className=n.id+"_select-item",-1==t)n.items[n.items.length]=a,n.appendChild(a);else{var o=n.items[t];n.items.splice(t,0,a),n.insertBefore(a,o)}a.addEventListener("click",function(t){if(n.isSelectMode){t.stopPropagation(),W4_GUI_Combobox.closeAllSelect();var r=n.items.indexOf(a);n.selectedIndex!=r&&W4_GUI_Combobox.setSelectedItem(e,r)}}),-1!=t&&t<=n.selectedIndex&&++n.selectedIndex,this.setSelectMode(n,!1)}},setCurrentItem:function(e,t){var r=OuterID.get(e);r&&r.selectedIndex!=t&&W4_GUI_Combobox.setSelectedItem(e,t)},update:function(e){var t=OuterID.get(e);if(t){t.isSelectMode?t.style.zIndex="99999999999":t.style.zIndex=t.widgetPOD.zOrder[0].toString(),1==t.widgetPOD.visible[0]?t.style.display="block":t.style.display="none";var r={x:t.widgetPOD.size[0],y:t.widgetPOD.size[1]},n=(W4_GUI.toNormalizeCoord(r,W4_GUI.virtualSize),0),a=0;switch(t.widgetPOD.verticalAlign[0]){case 1:a=50;break;case 2:a=100}switch(t.widgetPOD.horizontalAlign[0]){case 1:n=50;break;case 2:n=100}var o=W4_GUI.getVirtualSize(),i=W4_GUI.getScreenSize(),s="auto";1==t.widgetPOD.horizontalSize[0]&&(s=t.widgetPOD.size[0]/o.width*i.width+"px");var l,u;1==t.widgetPOD.verticalSize[0]&&(s=t.widgetPOD.size[1]/o.height*i.height+"px"),t.style.width=s,t.style.height="auto",t.isSelectMode?(l=t.items[0].clientWidth,u=t.items[0].clientHeight):(l=t.selectedDiv.clientWidth,u=t.selectedDiv.clientHeight);o=W4_GUI.getVirtualSize();var d=-l/(i=W4_GUI.getScreenSize()).width*n,c=-u/i.height*a,g={x:t.widgetPOD.position[0],y:t.widgetPOD.position[1]},f=W4_GUI.toNormalizeCoord(g,W4_GUI.getVirtualSize());t.style.left=(f.x+d)/100*i.width+"px",t.style.top=(f.y+c)/100*i.height+"px",t.style.opacity=t.widgetPOD.opacity[0].toString();var _=t.comboBoxPOD;t.defaultText.innerText=UTF8ToString(_.text[0]),-1==t.selectedIndex&&(t.selectedDiv.innerText=UTF8ToString(_.text[0]));var p=_.fontSize[0]/o.height*i.height;t.style.fontSize=p+"px",t.style.textAlign="center",t.style.fontFamily=UTF8ToString(_.font[0]),t.style.color=W4_GUI.toColor(_.fontColor[0]),_.fontBold[0]?t.style.fontWeight="bold":t.style.fontWeight="normal",_.fontItalic[0]?t.style.fontStyle="italic":t.style.fontStyle="normal",addStylesheetRules([["#"+t.id,["background-color",W4_GUI.toColor(_.bgColor[0])],["border-radius","1em"],["color",W4_GUI.toColor(_.bgColor[0])]]]),addStylesheetRules([["."+t.id+"_select-selected",["background-color",W4_GUI.toColor(_.bgColor[0])],["border-radius","1em"],["padding","0.5em 1em"],["user-select","none"]]]),addStylesheetRules([["."+t.id+"_select-item",["padding","0.5em 1em"],["width","auto"],["user-select","none"]]]),addStylesheetRules([["."+t.id+"_select-item:hover,."+t.id+"_same-as-selected",["background-color","rgba(0, 0, 0, 0.1)"]]])}},remove:function(e){W4_GUI.removeElement(e)},onTap:function(e,t){},setSelectMode:function(e,t){if(t){if(e.style.background=W4_GUI.toColor(e.comboBoxPOD.bgColor[0]),-1!=e.selectedIndex)(r=e.items[e.selectedIndex]).innerText=e.selectedDiv.innerText;e.selectedDiv.innerText=e.defaultText.innerText}else{if(e.isSelectMode&&-1!=e.selectedIndex){var r=e.items[e.selectedIndex];e.selectedDiv.innerText=r.innerText}e.style.background="transparent"}for(var n=0;n<e.items.length;n++){var a=e.items[n];a.style.opacity=t?"1":"0"}e.isSelectMode=t,setTimeout(function(){W4_GUI_Combobox.update(e.widgetID)},10)},closeAllSelect:function(e){for(var t=W4_GUI_Combobox.comboBoxes,r=t.length,n=t.indexOf(e),a=0;a<r;a++)a!=n&&W4_GUI_Combobox.setSelectMode(t[a],!1)}},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_create_combobox:function(e,t,r,n){return W4_GUI_Combobox.create(e,t,r,n)},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_combobox_add_item:function(e,t){W4_GUI_Combobox.addItem(e,UTF8ToString(t))},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_combobox_remove_item:function(e,t){W4_GUI_Combobox.removeItem(e,t)},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_combobox_insert_item:function(e,t,r){W4_GUI_Combobox.insertItem(e,t,UTF8ToString(r))},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_combobox_set_current:function(e,t){W4_GUI_Combobox.setCurrentItem(e,t)}};autoAddDeps(LibraryW4_GUI,"$W4_GUI_Combobox"),mergeInto(LibraryManager.library,LibraryW4_GUI);LibraryW4_GUI={$W4_GUI_Image__postset:'W4_GUI.registerWidgetClass("Widget_Image", W4_GUI_Image);',$W4_GUI_Image:{create:function(e,t,r,n){if(W4_GUI.isValid()){var a=document.createElement("img");a.style.position="absolute",a.style.display="none",a.style.pointerEvents="none",a.style.userSelect="none",a.style.margin="0";var o=W4_GUI.addElement(a),i=OuterID.get(t);i&&(a.widgetPOD=i);var s=OuterID.get(e);if(s&&(a.imagePOD=s),a.onload=function(){1===a.widgetPOD.size[0]&&(a.widgetPOD.size[0]=this.naturalWidth,a.widgetPOD.size[1]=this.naturalHeight,wasmTable.get(n)(r))},1==a.imagePOD.imgUpdated[0]){var l=W4_GUI.getImageUrl(a.imagePOD.image);a.crossOrigin="anonymous",a.src=l,a.imagePOD.imgUpdated[0]=0}return o}return console.error("W4_GUI.board not found!!!"),0},update:function(e){var t=W4_GUI.findElement(e);if(t){var r=t.imagePOD;if(r){var n="w4"+e.toString();if(t.id=n,1==r.imgUpdated[0]){var a=W4_GUI.getImageUrl(r.image);t.crossOrigin="anonymous",t.src=a,r.imgUpdated[0]=0}1==r.flipX[0]?t.style.transform="scale(-1, 1)":t.style.transform="scale(1, 1)"}this.updateWidget(t,t.widgetPOD)}},updateWidget:function(e,t){if(t){e.style.zIndex=t.zOrder[0].toString(),1==t.visible[0]?e.style.display="block":e.style.display="none";var r={x:t.size[0],y:t.size[1]},n=W4_GUI.toNormalizeCoord(r,W4_GUI.virtualSize);e.style.width=n.x+"%",e.style.height=n.y+"%",e.style["max-width"]=e.style.width,e.style["max-height"]=e.style.height;var a=0,o=0;switch(t.verticalAlign[0]){case 1:o=50;break;case 2:o=100}switch(t.horizontalAlign[0]){case 1:a=50;break;case 2:a=100}var i=e.getBoundingClientRect().width,s=e.getBoundingClientRect().height,l=W4_GUI.getScreenSize(),u=-i/l.width*a,d=-s/l.height*o,c={x:t.position[0],y:t.position[1]},g=W4_GUI.toNormalizeCoord(c,W4_GUI.virtualSize);e.style.left=g.x+u+"%",e.style.top=g.y+d+"%",e.style.opacity=t.opacity[0].toString()}},onTap:function(e,t){var r=W4_GUI.findElement(e);r&&(r.onTap&&(r.removeEventListener("click",r.onTap),r.onTap=void 0),t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTap=function(){W4_GUI.onEvent(e,W4_GUI.Event.Tap)},r.addEventListener("click",r.onTap)):(r.style.pointerEvents="none",r.style.userSelect="none"))},onTouchBegin:function(e,t){var r=W4_GUI.findElement(e);r&&(t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTouchBegin=function(){W4_GUI.onEvent(e,W4_GUI.Event.TouchBegin)},r.addEventListener("mousedown",r.onTouchBegin,!1)):(r.style.pointerEvents="none",r.style.userSelect="none",r.onTouchBegin&&r.removeEventListener("mousedown",r.onTouchBegin)))},onTouchEnd:function(e,t){var r=W4_GUI.findElement(e);r&&(t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTouchEnd=function(){W4_GUI.onEvent(e,2)},r.addEventListener("mouseup",r.onTouchEnd,!1)):(r.style.pointerEvents="none",r.style.userSelect="none",r.onTouchEnd&&r.removeEventListener("mouseup",r.onTouchEnd)))}},w4_gui_create_image:function(e,t,r,n){return W4_GUI_Image.create(e,t,r,n)}};autoAddDeps(LibraryW4_GUI,"$W4_GUI_Image"),mergeInto(LibraryManager.library,LibraryW4_GUI);LibraryW4_GUI={$W4_GUI_ImageButton__postset:'W4_GUI.registerWidgetClass("Widget_ImageButton", W4_GUI_ImageButton);',$W4_GUI_ImageButton:{create:function(e,t){if(W4_GUI.isValid()){var r=document.createElement("img");r.innerText="None",r.style.position="absolute",r.style.display="none",r.style.pointerEvents="auto",r.style.userSelect="none",r.style.margin="0";var n=W4_GUI.addElement(r),a=OuterID.get(e);if(a){var o=OuterID.get(t);r.widgetPOD=o,r.buttonPOD=a}return n}return console.error("W4_GUI.board not found!!!"),0},update:function(e){var t=OuterID.get(e);if(t){var r=t.buttonPOD,n=t.widgetPOD;if(n&&r){1==n.visible[0]?t.style.display="block":t.style.display="none";var a="w4"+e.toString();t.id=a,t.style.zIndex=n.zOrder[0].toString();var o={x:n.size[0],y:n.size[1]},i=W4_GUI.toNormalizeCoord(o,W4_GUI.virtualSize);t.style.width=i.x+"%",t.style.height=i.y+"%",t.style["max-width"]=t.style.width,t.style["max-height"]=t.style.height;var s=0,l=0;switch(n.verticalAlign[0]){case 1:l=50;break;case 2:l=100}switch(n.horizontalAlign[0]){case 1:s=50;break;case 2:s=100}var u=t.clientWidth,d=t.clientHeight,c=W4_GUI.getScreenSize(),g=-u/c.width*s,f=-d/c.height*l,_={x:n.position[0],y:n.position[1]},p=W4_GUI.toNormalizeCoord(_,W4_GUI.virtualSize);t.style.opacity=n.opacity[0].toString();var m=p.x+g,h=p.y+f,v=W4_GUI.getImageUrl(r.normalImage),b=W4_GUI.getImageUrl(r.pressedImage),I={x:r.pressedOffset[0],y:r.pressedOffset[1]},T=W4_GUI.toNormalizeCoord(I,W4_GUI.virtualSize),y=m+T.x+"%",w=h+T.y+"%";m+="%",h+="%",t.src=v,t.style.left=m,t.style.top=h,n.enabled[0]?(t.onmouseout=function(){t.src=v,t.style.left=m,t.style.top=h},t.ontouchend=function(){t.src=v,t.style.left=m,t.style.top=h},t.onmousedown=function(){t.src=b,t.style.left=y,t.style.top=w},t.ontouchstart=function(){t.src=b,t.style.left=y,t.style.top=w},t.ontouchcancel=function(){t.src=v,t.style.left=m,t.style.top=h},t.onmouseleave=function(){t.src=v,t.style.left=m,t.style.top=h},t.onmouseup=function(){t.src=v,t.style.left=m,t.style.top=h}):(t.src=v,t.style.left=m,t.style.top=h,t.onmouseout=void 0,t.ontouchend=void 0,t.onmousedown=void 0,t.ontouchstart=void 0,t.ontouchcancel=void 0,t.onmouseleave=void 0,t.onmouseup=void 0)}}},remove:function(e){W4_GUI.removeElement(e)},onTap:function(e,t){var r=W4_GUI.findElement(e);r&&(r.onTap&&(r.removeEventListener("click",r.onTap),r.onTap=void 0),t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTap=function(){W4_GUI.onEvent(e,W4_GUI.Event.Tap)},r.addEventListener("click",r.onTap)):(r.style.pointerEvents="none",r.style.userSelect="none"))},onTouchBegin:function(e,t){var r=W4_GUI.findElement(e);r&&(r.onTouchBegin&&(r.removeEventListener("mousedown",r.onTouchBegin),r.onTouchBegin=void 0),t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTouchBegin=function(){W4_GUI.onEvent(e,W4_GUI.Event.TouchBegin)},r.addEventListener("mousedown",r.onTouchBegin,!1)):(r.style.pointerEvents="none",r.style.userSelect="none",r.onTouchBegin&&r.removeEventListener("mousedown",r.onTouchBegin)))},onTouchEnd:function(e,t){var r=W4_GUI.findElement(e);r&&(r.onTouchEnd&&(r.removeEventListener("mouseup",r.onTouchEnd),r.onTouchEnd=void 0),t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTouchEnd=function(){W4_GUI.onEvent(e,2)},r.addEventListener("mouseup",r.onTouchEnd,!1)):(r.style.pointerEvents="none",r.style.userSelect="none",r.onTouchEnd&&r.removeEventListener("mouseup",r.onTouchEnd)))}},w4_gui_create_image_button:function(e,t){return W4_GUI_ImageButton.create(e,t)}};autoAddDeps(LibraryW4_GUI,"$W4_GUI_ImageButton"),mergeInto(LibraryManager.library,LibraryW4_GUI);LibraryW4_GUI={$W4_GUI_Label__postset:'W4_GUI.registerWidgetClass("Widget_Label", W4_GUI_Label);',$W4_GUI_Label:{create:function(e){if(W4_GUI.isValid()){var t=document.createElement("div");t.innerHTML="None",t.style.position="absolute",t.style.display="none",t.style.pointerEvents="none",t.style.margin="0",t.style.userSelect="none",t.style.webkitUserSelect="none";var r=W4_GUI.addElement(t),n=OuterID.get(e);if(n){var a=OuterID.get(n.widgetPOD[0]);t.widgetPOD=a,t.labelPOD=n}return r}return console.error("W4_GUI.board not found!!!"),0},update:function(e){var t=OuterID.get(e);if(t){var r,n=W4_GUI.getVirtualSize(),a=W4_GUI.getScreenSize();if(r=t.labelPOD){t.innerHTML=UTF8ToString(r.text[0]);var o=r.fontSize[0]/n.height*a.height;r.lineHeight[0],n.height,a.height;if(0!=r.shadowOffset[0]||0!=r.shadowOffset[1]){var i=r.shadowOffset[0]/n.width*a.width+"px "+r.shadowOffset[1]/n.height*a.height+"px "+W4_GUI.toColor(r.shadowColor[0]);t.style["text-shadow"]=i}t.style.fontSize=o+"px",t.style.fontFamily=UTF8ToString(r.font[0]),t.style.color=W4_GUI.toColor(r.fontColor[0]),t.style.background=W4_GUI.toColor(r.bgColor[0]),t.style.borderRadius="1em",t.style.padding=r.padding[0]+"em "+r.padding[1]+"em",t.style.boxSizing="border-box",r.fontBold[0]?t.style.fontWeight="bold":t.style.fontWeight="normal",r.fontItalic[0]?t.style.fontStyle="italic":t.style.fontStyle="normal";var s="left",l="flex-start";switch(r.horzTextAlign[0]){case 1:s="center";break;case 2:s="right"}switch(r.vertTextAlign[0]){case 1:l="center";break;case 2:l="flex-end"}t.style.justifyContent=s,t.style.alignItems=l}if(r=t.widgetPOD){t.style.zIndex=r.zOrder[0].toString(),1==r.visible[0]?t.style.display="flex":t.style.display="none";var u={x:r.size[0],y:r.size[1]},d=(W4_GUI.toNormalizeCoord(u,W4_GUI.getVirtualSize()),0),c=0;switch(r.verticalAlign[0]){case 1:c=50;break;case 2:c=100}switch(r.horizontalAlign[0]){case 1:d=50;break;case 2:d=100}var g="auto";1==r.horizontalSize[0]&&(g=r.size[0]/n.width*a.width+"px");var f="auto";1==r.verticalSize[0]&&(f=r.size[1]/n.height*a.height+"px"),t.style.width=g,t.style.height=f;var _=t.clientWidth,p=t.clientHeight,m=W4_GUI.getScreenSize(),h=-_/m.width*d,v=-p/m.height*c,b={x:r.position[0],y:r.position[1]},I=W4_GUI.toNormalizeCoord(b,W4_GUI.virtualSize);t.style.left=I.x+h+"%",t.style.top=I.y+v+"%",h=-d+"%",v=-c+"%",t.style.opacity=r.opacity[0].toString()}}},remove:function(e){W4_GUI.removeElement(e)},onTap:function(e,t){var r=W4_GUI.findElement(e);r&&(r.onTap&&(r.removeEventListener("click",r.onTap),r.onTap=void 0),t?(r.style.pointerEvents="auto",r.style.userSelect="none",r.onTap=function(){W4_GUI.onEvent(e,W4_GUI.Event.Tap)},r.addEventListener("click",r.onTap)):(r.style.pointerEvents="none",r.style.userSelect="none"))}},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_create_label_dummy:function(){},w4_gui_load_css_font:function(e){var t=document.createElement("link");t.rel="stylesheet",t.href=UTF8ToString(e),document.head.insertBefore(t,document.head.childNodes[document.head.childNodes.length-1].nextSibling)}};autoAddDeps(LibraryW4_GUI,"$W4_GUI_Label"),mergeInto(LibraryManager.library,LibraryW4_GUI);LibraryW4_GUI={$W4_GUI_Slider__postset:'W4_GUI.registerWidgetClass("Widget_Slider", W4_GUI_Slider);',$W4_GUI_Slider:{create:function(e,t,r,n){if(W4_GUI.isValid()){var a=document.createElement("input");a.type="range",a.style.position="absolute",a.style.display="none",a.style.pointerEvents="auto",a.style.userSelect="none","oninput"in a&&(a.oninput=function(){wasmTable.get(n)(r,this.value)}),a.onchange=function(){wasmTable.get(n)(r,this.value)};var o=W4_GUI.addElement(a),i=OuterID.get(e);if(i){var s=OuterID.get(t);a.widgetPOD=s,a.sliderPOD=i}return o}return console.error("Slider POD with id:"+sliderID+" not found!!!"),0},update:function(e){var t=OuterID.get(e);if(t){var r=t.sliderPOD;if(r){W4_GUI.getVirtualSize();var n=W4_GUI.getScreenSize(),a="w4"+e.toString();t.id=a,t.style.zIndex=t.widgetPOD.zOrder[0].toString(),1==t.widgetPOD.visible[0]?t.style.display="block":t.style.display="none";var o={x:t.widgetPOD.size[0],y:t.widgetPOD.size[1]},i=0,s=0;switch(t.widgetPOD.verticalAlign[0]){case 1:s=50;break;case 2:s=100}switch(t.widgetPOD.horizontalAlign[0]){case 1:i=50;break;case 2:i=100}t.max=r.max[0],t.min=r.min[0],t.value=r.value[0],t.step=r.step[0];W4_GUI.getVirtualSize(),n=W4_GUI.getScreenSize();var l=W4_GUI.toNormalizeCoord(o,W4_GUI.virtualSize);t.style.width=n.width*l.x/100+"px",t.style.height=n.height*l.y/100+"px",t.style["border-radius"]=n.height*l.y/100/2+"px",t.style["max-width"]=t.style.width,t.style["max-height"]=t.style.height;var u=t.clientWidth,d=t.clientHeight,c=-u/n.width*i,g=-d/n.height*s,f={x:t.widgetPOD.position[0],y:t.widgetPOD.position[1]},_=W4_GUI.toNormalizeCoord(f,W4_GUI.getVirtualSize());t.style.left=(_.x+c)/100*n.width+"px",t.style.top=(_.y+g)/100*n.height+"px",t.style.opacity=t.widgetPOD.opacity[0].toString(),t.style.border="1px solid "+W4_GUI.toColor(r.border[0]),t.style.outline="none",t.style["background-image"]=W4_GUI.CSSlinearGradient(r.bgTop[0],r.bgBottom[0]),t.style["background-repeat"]="no-repeat, no-repeat",t.style["-webkit-appearance"]="none",t.style["-moz-appearance"]="none",t.style["box-shadow"]="none";var p=[["-webkit-appearance","none"],["appearance","none"],["outline","none"],["cursor","pointer"],["width",t.style.height],["height",t.style.height],["border","1px solid "+W4_GUI.toColor(r.border[0])],["border-radius",n.height*l.y/100/2+"px"],["background-image",W4_GUI.CSSlinearGradient(r.fgTop[0],r.fgBottom[0])],["background-repeat","repeat-x"]];addStylesheetRules(navigator.userAgent.toLowerCase().indexOf("firefox")>-1?[["#"+a+"::-moz-range-thumb",p]]:[["#"+a+"::-webkit-slider-thumb",p]])}}},remove:function(e){W4_GUI.removeElement(e)}},LibraryW4_GUI__deps:["$W4_GUI"],w4_gui_create_slider:function(e,t,r,n){return W4_GUI_Slider.create(e,t,r,n)}};autoAddDeps(LibraryW4_GUI,"$W4_GUI_Slider"),mergeInto(LibraryManager.library,LibraryW4_GUI);LibraryW4_GUI={$$W4_GUI__postset:"Module.registerWidgetClass = W4_GUI.registerWidgetClass;",$W4_GUI:{_board:null,_onGUIEvent:void 0,virtualSize:{width:0,height:0},widgetClasses:{},imagesBlobs:{},isValid:function(){return void 0!==W4_GUI._board&&null!==W4_GUI._board},onEvent:function(e,t){wasmTable.get(W4_GUI._onGUIEvent)(e,t)},Event:{Tap:0,TouchBegin:1,TouchEnd:2},registerWidgetClass:function(e,t){void 0!==t.init&&t.init(),W4_GUI.widgetClasses[e]=t},findWidgetClass:function(e){return W4_GUI.widgetClasses[e]},addElement:function(e){return W4_GUI._board.appendChild(e),OuterID.make(e)},findElement:function(e){return OuterID.get(e)},removeElement:function(e){if(null!=e){var t=OuterID.get(e);t&&(W4_GUI._board.removeChild(t),OuterID.free(e))}},init:function(e,t){if(W4_GUI._board=document.getElementById(e),W4_GUI._onGUIEvent=t,null!=W4_GUI._board){var r=W4_GUI._board.getBoundingClientRect();r.width>r.height?(W4_GUI.virtualSize.width=1920,W4_GUI.virtualSize.height=1080):(W4_GUI.virtualSize.width=1080,W4_GUI.virtualSize.height=1920)}},getScreenSize:function(){if(null!=W4_GUI._board){var e=W4_GUI._board.getBoundingClientRect();return{width:e.width,height:e.height}}},getVirtualSize:function(){return W4_GUI.virtualSize},toNormalizeCoord:function(e,t){return{x:e.x/W4_GUI.virtualSize.width*100,y:e.y/W4_GUI.virtualSize.height*100}},delete:function(e){OuterID.free(e)},getImageUrl:function(e){0==e&&fatalError("getImageUrl '"+e+" is null pointer'");var t=UTF8ToString(e);if(0!=t.length){if(t in this.imagesBlobs)return this.imagesBlobs[t];if(W4FS.isURL(t))return t;var r=W4FS.get(t);void 0===r&&fatalError("fail to load image from '"+t+"'");var n=new Blob([r.data],{type:r.type}),a=(window.URL||window.webkitURL).createObjectURL(n);return this.imagesBlobs[t]=a,a}},toColor:function(e){return"rgba("+[(4278190080&(e>>>=0))>>>24,(16711680&e)>>>16,(65280&e)>>>8,(255&e)/255].join(",")+")"},CSSlinearGradient:function(e,t){return"linear-gradient(to bottom, "+this.toColor(e)+", "+this.toColor(t)+")"},toDarkenColor:function(e,t){return this.toLightenDarkenColor(e,-t)},toLightenColor:function(e,t){return this.toLightenDarkenColor(e,t)},toLightenDarkenColor:function(e,t){var r=(65280&(e>>>=0))>>>8,n=(16711680&e)>>>16,a=(4278190080&e)>>>24;return(a+=t)>255?a=255:a<0&&(a=0),(r+=t)>255?r=255:r<0&&(r=0),(n+=t)>255?n=255:n<0&&(n=0),"rgba("+[a,n,r,(255&e)/255].join(",")+")"},getFont:function(e){var t;switch(e){case 0:t="Courier New, Courier, monospace";break;case 1:t="Arial, sans-serif";break;case 2:t="Times, serif";break;case 3:t="Copperplate, fantasy";break;case 4:t="Helvetica, sans-serif";break;case 5:t="FreeMono, monospace";break;case 6:t="ComicSans, cursive";break;case 7:t="Tahoma, sans-serif";break;case 8:t="Lato, sans-serif";break;default:t="Courier New, Courier, monospace"}return t}},$addStylesheetRules:function(e){var t=document.createElement("style");document.head.appendChild(t);for(var r=t.sheet,n=0;n<e.length;n++){var a=1,o=e[n],i=o[0],s="";Array.isArray(o[1][0])&&(o=o[1],a=0);for(var l=o.length;a<l;a++){var u=o[a];s+=u[0]+": "+u[1]+(u[2]?" !important":"")+";\n"}var d=i+"{"+s+"}";r.insertRule(d,r.cssRules.length)}},w4_gui_init:function(e){return W4_GUI.init("w4-gui",e),!0},w4_gui_widget_update:function(e,t){var r=OuterID.get(e);if(r){var n=OuterID.get(t);if(n){r.style.zIndex=n.zOrder[0].toString(),1==n.visible[0]?r.style.display="block":r.style.display="none";var a={x:n.size[0],y:n.size[1]},o=(W4_GUI.toNormalizeCoord(a,W4_GUI.virtualSize),0),i=0;switch(n.verticalAlign[0]){case 1:i=50;break;case 2:i=100}switch(n.horizontalAlign[0]){case 1:o=50;break;case 2:o=100}r.style.width="auto",r.style.height="auto";var s=r.clientWidth,l=r.clientHeight,u=W4_GUI.getScreenSize(),d=-s/u.width*o,c=-l/u.height*i,g={x:n.position[0],y:n.position[1]},f=W4_GUI.toNormalizeCoord(g,W4_GUI.virtualSize);r.style.left=f.x+d+"%",r.style.top=f.y+c+"%",d=-o+"%",c=-i+"%",r.style.opacity=n.opacity[0].toString()}}},w4_gui_set_virtual_viewport:function(e,t){W4_GUI.virtualSize.width=e,W4_GUI.virtualSize.height=t},w4_gui_get_virtual_viewport:function(e){var t=new Uint32Array(wasmMemory.buffer,e,2);t[0]=W4_GUI.virtualSize.width,t[1]=W4_GUI.virtualSize.height},w4_gui_create_widget:function(e,t){var r=W4_GUI.findWidgetClass(UTF8ToString(e));return void 0!==r?r.create(t):OuterID.invalid},w4_gui_update_widget:function(e,t){var r=W4_GUI.findWidgetClass(UTF8ToString(e));void 0!==r&&r.update(t)},w4_gui_remove_widget:function(e,t){void 0!==W4_GUI.findWidgetClass(UTF8ToString(e))&&W4_GUI.removeElement(t)},w4_gui_on_event_widget:function(e,t,r,n){var a=W4_GUI.findWidgetClass(UTF8ToString(e));if(void 0!==a)switch(r){case 0:a.onTap&&a.onTap(t,n);break;case 1:a.onTouchBegin&&a.onTouchBegin(t,n);break;case 2:a.onTouchEnd&&a.onTouchEnd(t,n)}},w4_gui_set_screenshot_ignore:function(e,t){var r=OuterID.get(e);r&&(t?r.setAttribute("data-html2canvas-ignore",!0):r.removeAttribute("data-html2canvas-ignore"))},LibraryW4_GUI__deps:["$OuterID"]};autoAddDeps(LibraryW4_GUI,"$W4_GUI"),autoAddDeps(LibraryW4_GUI,"$addStylesheetRules"),mergeInto(LibraryManager.library,LibraryW4_GUI);var SurfaceLibrary={$Surface:{__internal:{cache:{},getVao:function(e,t){if(void 0!==t&&void 0!==e.verticesBuffer&&void 0!==e.indicesBuffer){var r=t.__outerId;r in this.cache||(this.cache[r]={});var n=this.cache[r];e.verticesBufferId in n&&!e.verticesBuffer.updated||(n[e.verticesBufferId]={},e.indicesBuffer.updated=!1);var a=n[e.verticesBufferId];if(!(e.indicesBufferId in a)||e.indicesBuffer.updated){e.indicesBuffer.updated=!1;var o=gl.createVertexArray();a[e.indicesBufferId]=o,gl.bindVertexArray(o),gl.bindBuffer(gl.ARRAY_BUFFER,e.verticesBuffer),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,e.indicesBuffer);var i=Material.getAttributes(t,e.renderType);for(var s in i){var l=i[s].location,u=e.verticesBuffer.vertexFormat.attributes[s];void 0===u&&fatalError("unknown vertex attribute "+s),gl.vertexAttribPointer(l,u.size/4,gl.FLOAT,!1,e.verticesBuffer.vertexFormat.stride,u.offset),gl.enableVertexAttribArray(l)}gl.bindVertexArray(null)}return a[e.indicesBufferId]}return null},updateVao:function(e){e.needUpdate&&(e.vao=this.getVao(e,e.material),e.vao&&(e.needUpdate=!1))},delete:function(e){gl.deleteVertexArray(e.vao)}},create:function(){var e={vao:void 0,material:void 0,verticesBuffer:void 0,verticesBufferId:void 0,indicesBuffer:void 0,indicesBufferId:void 0,renderType:void 0,needUpdate:!0,__vaoCache:{},__prevMat:{__outerId:void 0},__prevVao:void 0,getVao:function(e){(this.verticesBuffer.updated||this.indicesBuffer.updated)&&(this.needUpdate=!0,Surface.__internal.updateVao(this),this.__prevMat={__outerId:void 0},this.__prevVao=void 0);var t=e.__outerId;if(t===this.material.__outerId)return this.vao;if(t===this.__prevMat.__outerId)return this.__prevVao;var r=this.__vaoCache[t];return r||(r=Surface.__internal.getVao(this,e),this.__vaoCache[t]=r),this.__prevMat=e,this.__prevVao=r,r}};return Object.seal(e),OuterID.make(e)},setMaterial:function(e,t){var r=OuterID.get(e);r.material=OuterID.get(t),r.needUpdate=!0,this.__internal.updateVao(r)},setRenderType:function(e,t){var r=OuterID.get(e);r.renderType=t,r.needUpdate=!0,this.__internal.updateVao(r)},setVerticesBuffer:function(e,t){var r=OuterID.get(e);r.needUpdate=!0,r.verticesBufferId=t,r.verticesBuffer=OuterID.get(t),r.__vaoCache={},this.__internal.updateVao(r)},setIndicesBuffer:function(e,t){var r=OuterID.get(e);r.needUpdate=void 0===r.indicesBuffer,r.indicesBufferId=t,r.indicesBuffer=OuterID.get(t),r.__vaoCache={},this.__internal.updateVao(r)}},w4_render_Surface_create:function(){return Surface.create()},w4_render_Surface_materialChanged:function(e,t){Surface.setMaterial(e,t)},w4_render_Surface_verticesBufferChanged:function(e,t){Surface.setVerticesBuffer(e,t)},w4_render_Surface_indicesBufferChanged:function(e,t){Surface.setIndicesBuffer(e,t)},w4_render_Surface_renderTypeChanged:function(e,t){Surface.setRenderType(e,t)},w4_render_Surface_delete:function(e){OuterID.free(e)}};autoAddDeps(SurfaceLibrary,"$Surface"),mergeInto(LibraryManager.library,SurfaceLibrary);var RenderLibrar={$Render:{renderState:{buildInId:[],buildInData:[],convertW4TypeToGlType:function(e){var t;switch(e){case"int":t=gl.INT;break;case"float":t=gl.FLOAT;break;case"w4::math::vec2":t=gl.FLOAT_VEC2;break;case"w4::math::vec3":t=gl.FLOAT_VEC3;break;case"w4::math::vec4":t=gl.FLOAT_VEC4;break;case"w4::math::mat3":t=gl.FLOAT_MAT3;break;case"w4::math::mat4":t=gl.FLOAT_MAT4;break;case"TextureOuterId":t=gl.SAMPLER_2D}return t},convertTypes:function(e){for(var t in e.__glBinding={},e.__meta){var r=this.convertW4TypeToGlType(e.__meta[t].type);if(r){var n=e[t];if(Array.isArray(n))for(var a=0;a<n.length;++a)e.__glBinding[t+"["+a+"]"]={type:r,value:n[a]};else e.__glBinding[t]={type:r,value:n}}}},updateBuildInData:function(e,t){e.__idx=t,this.buildInData[t]=e,this.convertTypes(e),this.buildInId[t]?this.buildInId[t]++:this.buildInId[t]=1},updateFrame:function(e){this.frame=OuterID.get(e),this.updateBuildInData(this.frame,0)},updateShadow:function(e){this.shadowData=OuterID.get(e),this.updateBuildInData(this.shadowData,1)},updateObject:function(e){this.object=OuterID.get(e),this.updateBuildInData(this.object,2)},updateObjectData:function(e){this.objectData=OuterID.get(e)}},convertClearMask:function(e){var t=0;return 1&e&&(t|=gl.COLOR_BUFFER_BIT),2&e&&(t|=gl.DEPTH_BUFFER_BIT),t},clearBackBuffer:function(){var e=this.renderState.frame.clearColor,t=this.convertClearMask(this.renderState.frame.clearMask);t&gl.COLOR_BUFFER_BIT&&gl.clearColor(e[0],e[1],e[2],e[3]),0!==t&&gl.clear(t),this.renderState.prevProgram=null,this.renderState.prevMatInst=null,this.renderState.prevVao=null},prepareRender:function(){gl.enable(gl.CULL_FACE),gl.cullFace(gl.BACK),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL)},cleanupRender:function(){gl.bindVertexArray(null)},enableBlend:function(){gl.enable(gl.BLEND)},disableBlend:function(){gl.disable(gl.BLEND)},draw:function(){var e=this.renderState,t=e.object,r=e.objectData.surface[0],n=OuterID.get(r),a=this.overrideMaterial||n.material,o=n.getVao(a);o!==e.prevVao&&(gl.bindVertexArray(o),e.prevVao=o);var i=n.renderType,s=Material.getShaderProgram(a,i);if(s!==e.prevProgram){gl.useProgram(s),Material.resetBuiltinContext(a,i);var l=e.frame,u=e.shadowData;this.setupBuiltinParams(l,a,i),this.setupBuiltinParams(u,a,i),e.prevProgram=s,e.prevMatInst=void 0}e.prevMatInst!==a&&(Material.setupUserParams(a,i),e.prevMatInst=a),this.setupBuiltinParams(t,a,i),Render.renderState.isBlending&&gl.blendFunc(a.blending.src,a.blending.dst),gl.drawElements(a.material.primitiveType,n.indicesBuffer.count,gl.UNSIGNED_INT,n.indicesBuffer.offset)},setupBuiltinParams:function(e,t,r){var n=e.__idx,a=t.material;a.buildInId[n]!==this.renderState.buildInId[n]&&(Material.resetBuiltinParams(a,n,e),a.buildInId[n]=this.renderState.buildInId[n]),Material.setupBuiltinParams(t,n,r)}},w4lRenderUpdateRenderState:function(e,t,r,n){Render.renderState.updateFrame(e),Render.renderState.updateShadow(t),Render.renderState.updateObject(r),Render.renderState.updateObjectData(n)},w4lRenderDrawRenderState:function(){Render.draw()},w4lRenderClearBackBuffer:function(){Render.clearBackBuffer()},w4lRenderPrepareRender:function(){Render.prepareRender()},w4lRenderCleanupRender:function(){Render.cleanupRender()},w4lRenderSetBlending:function(e){Render.renderState.isBlending=e,e?Render.enableBlend():Render.disableBlend()},w4lRenderForceVaoDrop:function(){gl.bindVertexArray(null)},w4lRenderSetDepthTest:function(e){e?gl.enable(gl.DEPTH_TEST):gl.disable(gl.DEPTH_TEST)},w4lRenderSetOverrideMaterial:function(e){e==OuterID.invalid?(Render.overrideMaterial=null,Render.overrideMaterialId=null):(Render.overrideMaterial=OuterID.get(e),Render.overrideMaterialId=e)}};autoAddDeps(RenderLibrar,"$Render"),mergeInto(LibraryManager.library,RenderLibrar);var LibRenderTarget={$__RenderTargetInternal:{deleter:function(e){gl.deleteFramebuffer(e)}},w4lRenderTargetCreate__deps:["$__RenderTargetInternal"],w4lRenderTargetCreate:function(e,t,r,n,a){var o=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,o);var i=OuterID.get(n);if(gl.bindTexture(gl.TEXTURE_2D,i),r?(gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA32F,e,t,0,gl.RGBA,gl.FLOAT,null),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,i,0)):(gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,t,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.texParameterf(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameterf(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,i,0)),a&&a!==OuterID.invalid){var s=OuterID.get(a);gl.bindTexture(gl.TEXTURE_2D,s),gl.texImage2D(gl.TEXTURE_2D,0,Platform.depthSupportedFormat,e,t,0,gl.DEPTH_COMPONENT,gl.UNSIGNED_INT,null),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,s,0)}else{var l=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,l),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,e,t),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,l),gl.bindRenderbuffer(gl.RENDERBUFFER,null)}return gl.checkFramebufferStatus(gl.FRAMEBUFFER)!==gl.FRAMEBUFFER_COMPLETE&&console.log(gl.getError()),gl.bindFramebuffer(gl.FRAMEBUFFER,null),OuterID.make(o,__RenderTargetInternal.deleter)},w4lRenderTargetDelete:function(e){OuterID.free(e)},w4lRenderTargetSetup:function(e,t,r,n,a){a==OuterID.invalid?gl.bindFramebuffer(gl.FRAMEBUFFER,null):gl.bindFramebuffer(gl.FRAMEBUFFER,OuterID.get(a)),gl.viewport(e,t,r,n)}};mergeInto(LibraryManager.library,LibRenderTarget);var MaterialImpl={$Material__deps:["$Render"],$Material:{materialCache:{},findInCache:function(e,t){return e in this.materialCache?this.materialCache[e][t]:null},convertBlendEnum:function(e){switch(e){case 0:return gl.ZERO;case 1:return gl.ONE;case 2:return gl.SRC_COLOR;case 3:return gl.ONE_MINUS_SRC_COLOR;case 4:return gl.DST_COLOR;case 5:return gl.ONE_MINUS_DST_COLOR;case 6:return gl.SRC_ALPHA;case 7:return gl.ONE_MINUS_SRC_ALPHA;case 8:return gl.DST_ALPHA;case 9:return gl.ONE_MINUS_DST_ALPHA;case 10:return gl.CONSTANT_COLOR;case 11:return gl.ONE_MINUS_CONSTANT_COLOR;case 12:return gl.CONSTANT_ALPHA;case 13:return gl.ONE_MINUS_CONSTANT_ALPHA;case 14:return gl.SRC_ALPHA_SATURATE;default:return gl.ZERO}},getValueSizeInFloats:function(e){switch(e){case"ID":case gl.FLOAT:return 1;case gl.FLOAT_VEC2:return 2;case gl.FLOAT_VEC3:return 3;case gl.FLOAT_VEC4:return 4;case gl.INT:return 1;case gl.INT_VEC2:return 2;case gl.INT_VEC3:return 3;case gl.INT_VEC4:return 4;case gl.BOOL:return 1;case gl.BOOL_VEC2:return 2;case gl.BOOL_VEC3:return 3;case gl.BOOL_VEC4:case gl.FLOAT_MAT2:return 4;case gl.FLOAT_MAT3:return 9;case gl.FLOAT_MAT4:return 16;case gl.SAMPLER_2D:case gl.SAMPLER_CUBE:return 1}return log.Error("Material: unknown uniform type '"+e+"'"),0},createUniformView:function(e,t,r){switch(r=r||1,t){case gl.INT:return new Int32Array(wasmMemory.buffer,e,Material.getValueSizeInFloats(t)*r);case gl.FLOAT:case gl.FLOAT_VEC2:case gl.FLOAT_VEC3:case gl.FLOAT_VEC4:case gl.FLOAT_MAT3:case gl.FLOAT_MAT4:return new Float32Array(wasmMemory.buffer,e,Material.getValueSizeInFloats(t)*r);case gl.SAMPLER_2D:case gl.SAMPLER_CUBE:return new Int32Array(wasmMemory.buffer,e,Material.getValueSizeInFloats(t)*r)}return log.Error("RenderState: unsupported field type '"+t+"'"),null},createShader:function(e,t){var r=null;switch(t){case 1:r=gl.VERTEX_SHADER;break;case 2:r=gl.FRAGMENT_SHADER}var n=gl.createShader(r);return gl.shaderSource(n,AsciiToString(e)),gl.compileShader(n),gl.getShaderParameter(n,gl.COMPILE_STATUS)?OuterID.make(n,Material.deleteShader):(fatalError("could not compile shader("+t+"): "+gl.getShaderInfoLog(n)+"\n"+AsciiToString(e)),OuterID.invalid)},deleteShader:function(e){gl.deleteShader(e)},createShaderProgram:function(e,t,r,n,a){var o=this.findInCache(t,r);if(o)for(d=0;d<o.paramMapping.length;++d){g=o.paramMapping[d].uniform,v=Module._malloc(g.name.length+1);stringToAscii(g.name,v);b=4*this.getValueSizeInFloats(g.type);wasmTable.get(a)(e.context,v,g.type,b),Module._free(v)}else{var i=gl.createProgram();if(gl.attachShader(i,OuterID.get(t)),gl.attachShader(i,OuterID.get(r)),gl.linkProgram(i),!gl.getProgramParameter(i,gl.LINK_STATUS))return fatalError("program failed to link: "+gl.getProgramInfoLog(i)),OuterID.invalid;for(var s=gl.getProgramParameter(i,gl.ACTIVE_UNIFORMS),l=[],u={},d=0;d<s;d++){var c,g=gl.getActiveUniform(i,d),f=gl.getUniformLocation(i,g.name);if("[0]"===g.name.substr(-3)){c=g.name.slice(0,-3);for(var _=0;_<g.size;++_){var p=c+"["+_+"]";f=gl.getUniformLocation(i,p),u[p]={info:g,location:f}}}else u[c=g.name]={info:g,location:f};for(var m=!1,h=0;h<Render.renderState.buildInData.length;h++)if(c in Render.renderState.buildInData[h]){m=!0;break}if(!m){var v=Module._malloc(g.name.length+1);stringToAscii(g.name,v);var b=4*this.getValueSizeInFloats(g.type),I=wasmTable.get(a)(e.context,v,g.type,b);Module._free(v),l.push({uniform:g,location:f,offset:I})}}for(var T=gl.getProgramParameter(i,gl.ACTIVE_ATTRIBUTES),y={},w={},d=0;d<T;d++){var S=gl.getActiveAttrib(i,d);y[d]=S;var E=gl.getAttribLocation(i,S.name);w[S.name]={info:S,location:E}}o={program:i,paramMapping:l,attributes:w,uniforms:u,buildInSetters:[],builtInContext:{currentTextureIdx:0}},t in this.materialCache||(this.materialCache[t]={}),this.materialCache[t][r]=o}return e.programs[n]=o,e.programs.length-1},createMaterial:function(e,t){var r={0:gl.POINTS,1:gl.LINE_STRIP,2:gl.LINE_LOOP,3:gl.LINES,4:gl.TRIANGLE_STRIP,5:gl.TRIANGLE_FAN,6:gl.TRIANGLES};return OuterID.make({context:e,programs:{},buildInId:[],primitiveType:r[t]},Material.deleteMaterial)},getShaderProgram:function(e,t){return e.material.programs[t].program},deleteMaterial:function(e){gl.deleteProgram(e.program)},createMaterialInst:function(e,t){var r={},n={},a=OuterID.get(e);for(var o in a.programs){var i=a.programs[o],s={},l=[];for(var u in i.paramMapping){var d=i.paramMapping[u],c={view:this.createUniformView(t+d.offset,d.uniform.type),location:d.location,uniform:d.uniform};s[d.uniform.name]=c,l.push(c)}r[o]=s,n[o]=l}return OuterID.make({material:a,dataPtr:t,userParams:r,userParamsList:n,blending:{src:gl.ONE,dst:gl.ZERO}},Material.deleteMaterialInst)},deleteMaterialInst:function(e){},setupUserParams:function(e,t){for(var r={currentTextureIdx:e.material.programs[t].builtInContext.currentTextureIdx},n=e.userParamsList[t],a=0,o=n.length;a<o;a++){var i=n[a];this.setParam(i.location,i.uniform.type,i.view,r)}},getAttributes:function(e,t){return e.material.programs[t].attributes},resetBuiltinParams:function(e,t,r){for(var n in e.programs){var a=e.programs[n];for(var o in a.buildInSetters[t]=[],r.__glBinding){var i=r.__glBinding[o],s=i.value,l=a.uniforms[o];void 0!==l&&Material.addBuiltinSetter(a,t,l,i.type,s)}}},resetBuiltinContext:function(e,t){e.material.programs[t].builtInContext.currentTextureIdx=0},setupBuiltinParams:function(e,t,r){for(var n=e.material.programs[r],a=0,o=n.buildInSetters[t].length;a<o;a++)n.buildInSetters[t][a]()},addBuiltinSetter:function(e,t,r,n,a){e.buildInSetters[t].push(function(){Material.setParam(r.location,n,a,e.builtInContext)})},setBlending:function(e,t,r){var n=OuterID.get(e);n.blending.src=t,n.blending.dst=r},setParam:function(e,t,r,n){switch(t){case gl.FLOAT:gl.uniform1f(e,r);break;case gl.INT:gl.uniform1i(e,r);break;case gl.FLOAT_VEC2:gl.uniform2fv(e,r);break;case gl.FLOAT_VEC3:gl.uniform3fv(e,r);break;case gl.FLOAT_VEC4:gl.uniform4fv(e,r);break;case gl.FLOAT_MAT3:gl.uniformMatrix3fv(e,!1,r);break;case gl.FLOAT_MAT4:gl.uniformMatrix4fv(e,!1,r);break;case gl.SAMPLER_2D:if((o=r[0])!=OuterID.invalid){var a=OuterID.get(o);gl.activeTexture(gl.TEXTURE0+n.currentTextureIdx),a?(gl.bindTexture(gl.TEXTURE_2D,a),gl.uniform1i(e,n.currentTextureIdx)):gl.bindTexture(gl.TEXTURE_2D,null),n.currentTextureIdx=n.currentTextureIdx+1}break;case gl.SAMPLER_CUBE:var o;if((o=r[0])!=OuterID.invalid){a=OuterID.get(o);gl.activeTexture(gl.TEXTURE0+n.currentTextureIdx),a?(gl.bindTexture(gl.TEXTURE_CUBE_MAP,a),gl.uniform1i(e,+n.currentTextureIdx)):gl.bindTexture(gl.TEXTURE_CUBE_MAP,null),n.currentTextureIdx=n.currentTextureIdx+1}}}},w4_Shader_create:function(e,t){return Material.createShader(e,t)},w4_ShaderProgram_create:function(e,t,r,n,a){return Material.createShaderProgram(OuterID.get(e),t,r,n,a)},w4_Material_create:function(e,t){return Material.createMaterial(e,t)},w4_Material_isCompatible:function(e,t){var r=OuterID.get(e).attributes,n=OuterID.get(t).descr;for(key in r){if(!(key in n))return log.error("no key '"+key+"' in vertices buffer format"),-1;var a=r[key].info,o=n[key],i=a.size*Material.getValueSizeInFloats(a.type)*4,s=o.size;if(i!==s)return log.error("key '"+key+"': size differ in material("+i+") and vertices buffer("+s+")"),-2}return 0},w4_MaterialInst_create:function(e,t){return Material.createMaterialInst(e,t)},w4_MaterialInst_setBlending:function(e,t,r){return Material.setBlending(e,Material.convertBlendEnum(t),Material.convertBlendEnum(r))}};autoAddDeps(MaterialImpl,"$Platform"),autoAddDeps(MaterialImpl,"$Material"),autoAddDeps(MaterialImpl,"$OuterID"),mergeInto(LibraryManager.library,MaterialImpl);var LibraryCubemap={$__CubemapsInternal__deps:["$__TexturesInternal"],$__CubemapsInternal:{defaults:{min:function(){return gl.LINEAR},mag:function(){return gl.LINEAR},wrapS:function(){return gl.CLAMP_TO_EDGE},wrapT:function(){return gl.CLAMP_TO_EDGE},NEGATIVE_X:[1,0,0,1],POSITIVE_X:[0,1,1,1],NEGATIVE_Y:[0,1,0,1],POSITIVE_Y:[1,0,1,1],NEGATIVE_Z:[0,0,1,1],POSITIVE_Z:[1,1,0,1]},setParameters:function(e,t){("min"in e||t)&&gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,"min"in e?e.min:this.defaults.min()),("mag"in e||t)&&gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,"mag"in e?e.mag:this.defaults.mag()),("wrapS"in e||t)&&gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,"wrapS"in e?e.wrapS:this.defaults.wrapS()),("wrapT"in e||t)&&gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,"wrapT"in e?e.wrapT:this.defaults.wrapT())},loadImage:function(e,t,r){gl.texImage2D(gl["TEXTURE_CUBE_MAP_"+r],0,gl.RGBA,__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData)),Images.get(e).then(function(e){gl.isTexture(t)&&(gl.bindTexture(gl.TEXTURE_CUBE_MAP,t),gl.texImage2D(gl["TEXTURE_CUBE_MAP_"+r],0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,e),gl.bindTexture(gl.TEXTURE_CUBE_MAP,null))})},delete:function(e){gl.deleteTexture(e)},decodeFilterLevel:function(e,t){switch(e){case 0:return t.min=gl.NEAREST,void(t.mag=gl.NEAREST);case 1:return t.min=gl.LINEAR,void(t.mag=gl.LINEAR);case 2:return t.min=gl.LINEAR_MIPMAP_NEAREST,void(t.mag=gl.LINEAR);case 3:return t.min=gl.LINEAR_MIPMAP_LINEAR,void(t.mag=gl.LINEAR)}},decodeWrap:function(e,t,r){switch(e){case 0:return void(t[r]=gl.REPEAT);case 1:return void(t[r]=gl.MIRRORED_REPEAT);case 2:return void(t[r]=gl.CLAMP_TO_EDGE)}},decodeParameters:function(e,t,r,n){return this.decodeFilterLevel(t,e),this.decodeWrap(r,e,"wrapS"),this.decodeWrap(n,e,"wrapT"),e}},$Cubemaps__deps:["$__CubemapsInternal","$__TexturesInternal"],$Cubemaps:{create:function(e){var t=gl.createTexture();return gl.bindTexture(gl.TEXTURE_CUBE_MAP,t),__CubemapsInternal.setParameters(e,!0),__CubemapsInternal.loadImage(e.sources.POSITIVE_X,t,"POSITIVE_X"),__CubemapsInternal.loadImage(e.sources.NEGATIVE_X,t,"NEGATIVE_X"),__CubemapsInternal.loadImage(e.sources.POSITIVE_Y,t,"POSITIVE_Y"),__CubemapsInternal.loadImage(e.sources.NEGATIVE_Y,t,"NEGATIVE_Y"),__CubemapsInternal.loadImage(e.sources.POSITIVE_Z,t,"POSITIVE_Z"),__CubemapsInternal.loadImage(e.sources.NEGATIVE_Z,t,"NEGATIVE_Z"),gl.bindTexture(gl.TEXTURE_CUBE_MAP,null),OuterID.make(t,__CubemapsInternal.delete)},createDefault:function(e){var t=gl.createTexture();return gl.bindTexture(gl.TEXTURE_CUBE_MAP,t),__CubemapsInternal.setParameters(new Object,!0),gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,gl.RGBA,__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData)),gl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,gl.RGBA,__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData)),gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,gl.RGBA,__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData)),gl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,gl.RGBA,__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData)),gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,gl.RGBA,__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData)),gl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,gl.RGBA,__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData)),gl.bindTexture(gl.TEXTURE_CUBE_MAP,null),OuterID.make(t,__CubemapsInternal.delete)},update:function(e,t){gl.bindTexture(gl.TEXTURE_CUBE_MAP,OuterID.get(e)),__CubemapsInternal.setParameters(t,!1),gl.bindTexture(gl.TEXTURE_CUBE_MAP,null)},delete:function(e){OuterID.free(e)}},w4_Cubemap_create__deps:["$__CubemapsInternal"],w4_Cubemap_create:function(e,t,r,n,a,o,i,s,l){return Cubemaps.create(__CubemapsInternal.decodeParameters({sources:{POSITIVE_X:e,NEGATIVE_X:t,POSITIVE_Y:r,NEGATIVE_Y:n,POSITIVE_Z:a,NEGATIVE_Z:o}},i,s,l))},w4_Cubemap_createDefault:function(){return Cubemaps.createDefault()},w4_Cubemap_update__deps:["$__CubemapsInternal"],w4_Cubemap_update:function(e,t,r,n){Cubemaps.update(e,__CubemapsInternal.decodeParameters(new Object,t,r,n))},w4_Cubemap_delete:function(e){Cubemaps.delete(e)}};autoAddDeps(LibraryCubemap,"$Cubemaps"),mergeInto(LibraryManager.library,LibraryCubemap);var LibraryImages={$Images:{isPowerOfTwo:function(e){return 0==(e&e-1)},nextHighestPowerOfTwo:function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},processImagePowerOf2:function(e){if(null!=e){if(!Images.isPowerOfTwo(e.width)||!Images.isPowerOfTwo(e.height)){var t=document.createElement("canvas");return t.width=Images.nextHighestPowerOfTwo(e.width),t.height=Images.nextHighestPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e}},createFromUrl:function(e){var t={image:new Image,isLoaded:!1,callbacks:[]};t.image.onload=function(){var e=t.image.src;URL.revokeObjectURL(e),t.isLoaded=!0,t.callbacks.forEach(function(e){e()})},t.image.onerror=function(){fatalError("fail to load image from '"+e+"'")};var r=e;if(!W4FS.isURL(e)){var n=W4FS.get(e);void 0===n&&fatalError("fail to load image from '"+e+"'");var a=new Blob([n.data],{type:n.type});r=(window.URL||window.webkitURL).createObjectURL(a)}return t.image.crossOrigin="anonymous",t.image.src=r,OuterID.make(t)},createFromData:function(e,t){var r={image:new Image,isLoaded:!1,callbacks:[]};r.image.onload=function(){var e=r.image.src;URL.revokeObjectURL(e),r.isLoaded=!0,r.callbacks.forEach(function(e){e()})},r.image.onerror=function(){fatalError("fail to load image from data, type is "+e)};var n=new Blob([t],{type:e}),a=(window.URL||window.webkitURL).createObjectURL(n);return r.image.crossOrigin="anonymous",r.image.src=a,OuterID.make(r)},createFromBlob:function(e){var t={image:new Image,isLoaded:!1,callbacks:[]};return t.image.onload=function(){var e=t.image.src;URL.revokeObjectURL(e),t.isLoaded=!0,t.callbacks.forEach(function(e){e()})},t.image.onerror=function(){fatalError("fail to load image from blob")},t.image.crossOrigin="anonymous",t.image.src=e,OuterID.make(t)},get:function(e){return new Promise(function(t){var r=OuterID.get(e),n=function(){t(r.image)};r.isLoaded?n():r.callbacks.push(n)})},delete:function(e){OuterID.free(e)}},w4_Image_createFromUrl:function(e){return Images.createFromUrl(UTF8ToString(e))},w4_Image_createFromData:function(e,t,r){return Images.createFromData(UTF8ToString(e),new Uint8Array(wasmMemory.buffer,t,r))},w4_Image_delete:function(e){return Images.delete(e)}};autoAddDeps(MaterialImpl,"$Platform"),autoAddDeps(LibraryImages,"$Images"),autoAddDeps(LibraryImages,"$W4FS"),mergeInto(LibraryManager.library,LibraryImages);var LibraryTextures={$__TexturesInternal:{defaultTextures:{default:{textureData:[0,0,0,255,255,0,255,255,255,0,255,255,0,0,0,255],textureWidth:2,textureHeight:2},transparent:{textureData:[0,0,0,0,255,0,255,0,255,0,255,0,0,0,0,0],textureWidth:2,textureHeight:2}},defaults:{minFilter:function(){return gl.LINEAR},magFilter:function(){return gl.LINEAR},wrapS:function(){return gl.CLAMP_TO_EDGE},wrapT:function(){return gl.CLAMP_TO_EDGE}},deleteTexture:function(e){gl.deleteTexture(e)},setParameters:function(e){gl.texParameterf(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,e.minFilter),gl.texParameterf(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,e.magFilter),gl.texParameterf(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,e.wrapS),gl.texParameterf(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,e.wrapT)},decodeFilterLevel:function(e,t){switch(e){case 0:return t.minFilter=gl.NEAREST,void(t.magFilter=gl.NEAREST);case 1:return t.minFilter=gl.LINEAR,void(t.magFilter=gl.LINEAR);case 2:return t.minFilter=gl.LINEAR_MIPMAP_NEAREST,void(t.magFilter=gl.LINEAR);case 3:return t.minFilter=gl.LINEAR_MIPMAP_LINEAR,void(t.magFilter=gl.LINEAR)}fatalError("texture.setFilters: unsupported filter level '"+e+"'")},decodeWrap:function(e,t,r){switch(e){case 0:return void(t[r]=gl.REPEAT);case 1:return void(t[r]=gl.MIRRORED_REPEAT);case 2:return void(t[r]=gl.CLAMP_TO_EDGE)}fatalError("texture.setFilters: unsupported '"+r+"' wrapping '"+e+"'")},decodeParameters:function(e,t,r,n){return this.decodeFilterLevel(t,e),this.decodeWrap(r,e,"wrapS"),this.decodeWrap(n,e,"wrapT"),e},validateParameters:function(e){e.hasOwnProperty("minFilter")||(e.minFilter=__TexturesInternal.defaults.minFilter()),e.hasOwnProperty("magFilter")||(e.magFilter=__TexturesInternal.defaults.magFilter()),e.hasOwnProperty("wrapS")||(e.wrapS=__TexturesInternal.defaults.wrapS()),e.hasOwnProperty("wrapT")||(e.wrapT=__TexturesInternal.defaults.wrapT())},generateMipmap:function(e){e.minFilter!==gl.LINEAR&&e.minFilter!==gl.LINEAR_MIPMAP_LINEAR&&e.minFilter!==gl.LINEAR_MIPMAP_NEAREST||gl.generateMipmap(gl.TEXTURE_2D)},callbackCreateBegin:function(){},callbackCreateEnd:function(){}},$Textures__deps:["$__TexturesInternal"],$Textures:{initialize:function(e,t){__TexturesInternal.callbackCreateBegin=e,__TexturesInternal.callbackCreateEnd=t},create:function(e,t,r=!1){__TexturesInternal.callbackCreateBegin();var n=r?Textures.prototype(t,new Uint8Array(__TexturesInternal.defaultTextures.transparent.textureData),__TexturesInternal.defaultTextures.transparent.textureWidth,__TexturesInternal.defaultTextures.transparent.textureHeight):Textures.prototype(t,new Uint8Array(__TexturesInternal.defaultTextures.default.textureData),__TexturesInternal.defaultTextures.default.textureWidth,__TexturesInternal.defaultTextures.default.textureHeight);return Images.get(e).then(function(e){var r=Images.processImagePowerOf2(e);gl.bindTexture(gl.TEXTURE_2D,OuterID.get(n)),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,r),__TexturesInternal.validateParameters(t),__TexturesInternal.setParameters(t),__TexturesInternal.generateMipmap(t),gl.bindTexture(gl.TEXTURE_2D,null),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),__TexturesInternal.callbackCreateEnd()}),gl.bindTexture(gl.TEXTURE_2D,null),n},createEmpty:function(e){var t=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,t),__TexturesInternal.validateParameters(e),__TexturesInternal.setParameters(e),OuterID.make(t,__TexturesInternal.deleteTexture)},prototype:function(e,t,r,n){var a=Textures.createEmpty(e);return gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,r,n,0,gl.RGBA,gl.UNSIGNED_BYTE,t),__TexturesInternal.generateMipmap(e),a},update:function(e,t){gl.bindTexture(gl.TEXTURE_2D,OuterID.get(e)),__TexturesInternal.validateParameters(t),__TexturesInternal.setParameters(t),__TexturesInternal.generateMipmap(t),gl.bindTexture(gl.TEXTURE_2D,null)},delete:function(e){OuterID.free(e)}},w4_Texture_initialize__deps:["$__TexturesInternal"],w4_Texture_initialize:function(e,t){Textures.initialize(wasmTable.get(e),wasmTable.get(t))},w4_Texture_create__deps:["$__TexturesInternal"],w4_Texture_create:function(e,t,r,n){var a=__TexturesInternal.decodeParameters(new Object,t,r,n);return OuterID.isValid(e)?Textures.create(e,a):Textures.createEmpty(a)},w4_Texture_createDefault:function(){var e=__TexturesInternal.defaultTextures.default,t={};return t.minFilter=gl.NEAREST,t.magFilter=gl.NEAREST,t.wrapS=gl.REPEAT,t.wrapT=gl.REPEAT,Textures.prototype(t,new Uint8Array(e.textureData),e.textureWidth,e.textureHeight)},w4_Texture_createColor:function(e,t,r,n){var a=[e,t,r,n,e,t,r,n,e,t,r,n,e,t,r,n],o={};return o.minFilter=gl.NEAREST,o.magFilter=gl.NEAREST,o.wrapS=gl.REPEAT,o.wrapT=gl.REPEAT,Textures.prototype(o,new Uint8Array(a),2,2)},w4_Texture_createText:function(e,t,r,n,a,o,i,s,l,u,d,c,g,f,_,p){var m={};m.minFilter=gl.NEAREST,m.magFilter=gl.NEAREST,m.wrapS=gl.REPEAT,m.wrapT=gl.REPEAT;var h=UTF8ToString(e),v=document.createElement("canvas"),b=v.getContext("2d");b.textAlign="left",b.textBaseline="top";var I,T=["normal","italic","oblique"],y=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"];I=r&&n?T[r]+" "+y[n]+" "+t+"px "+UTF8ToString(a):r?T[r]+" "+t+"px "+UTF8ToString(a):n?y[n]+" "+t+"px "+UTF8ToString(a):t+"px "+UTF8ToString(a),b.font=I;var w=b.measureText(h);v.width=w.width,v.height=Math.abs(w.actualBoundingBoxDescent)+Math.abs(w.actualBoundingBoxAscent),b.textAlign="left",b.textBaseline="top",b.font=I,2&o&&(b.lineWidth=i,b.strokeStyle="rgba("+c+","+g+","+f+","+_+")",b.strokeText(h,0,0)),1&o&&(b.fillStyle="rgba("+s+","+l+","+u+","+d+")",b.fillText(h,0,0));var S=Images.createFromBlob(b.canvas.toDataURL("image/png")),E=new Uint32Array(wasmMemory.buffer,p,2);return E[0]=v.width,E[1]=v.height,OuterID.isValid(S)?Textures.create(S,m,!0):Textures.createEmpty(m)},w4_Texture_createFromMemory__deps:["$__TexturesInternal"],w4_Texture_createFromMemory:function(e,t,r,n,a,o){var i=__TexturesInternal.decodeParameters({},n,a,o),s=new Uint8Array(wasmMemory.buffer,e,t*r*4);return Textures.prototype(i,s,t,r)},w4_Texture_createFromVideo__deps:["$__TexturesInternal"],w4_Texture_createFromVideo:function(e,t,r){var n=__TexturesInternal.decodeParameters({},e,t,r),a=new Uint8Array([255,0,255,255]);return Textures.prototype(n,a,1,1)},w4_VideoTexture_update:function(e,t){var r=OuterID.get(t);if(r.readyState>=r.HAVE_CURRENT_DATA){var n=gl.RGBA,a=gl.RGBA,o=gl.UNSIGNED_BYTE;gl.bindTexture(gl.TEXTURE_2D,OuterID.get(e)),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.texImage2D(gl.TEXTURE_2D,0,n,a,o,r),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),gl.bindTexture(gl.TEXTURE_2D,null)}},w4_Texture_update__deps:["$__TexturesInternal"],w4_Texture_update:function(e,t,r,n){Textures.update(e,__TexturesInternal.decodeParameters(new Object,t,r,n))},w4_Texture_delete:function(e){Textures.delete(e)}};autoAddDeps(LibraryTextures,"$Textures"),mergeInto(LibraryManager.library,LibraryTextures);var DataBufferLibrary={$DataBuffer:{__internal:{indicesTypeLength:4,decryptBufferUsage:function(e){switch(e){case 0:return gl.STATIC_DRAW;case 1:return gl.DYNAMIC_DRAW;case 2:return gl.STREAM_DRAW}fatalError("invalid buffer usage value: "+e)},delete:function(e){gl.deleteBuffer(e)}},createVerticesBuffer:function(e,t){var r=gl.createBuffer();for(var n in r.type=gl.ARRAY_BUFFER,r.usage=e,r.vertexFormat={attributes:OuterID.get(t).descr,stride:0},r.vertexFormat.attributes)r.vertexFormat.stride+=r.vertexFormat.attributes[n].size;return r.data=void 0,Object.seal(r),Object.freeze(r.vertexFormat),OuterID.make(r,this.__internal.delete)},createIndicesBuffer:function(e){var t=gl.createBuffer();return t.type=gl.ELEMENT_ARRAY_BUFFER,t.usage=e,t.offset=0,t.count=0,OuterID.make(t,this.__internal.delete)},updateData:function(e,t,r){var n,a=OuterID.get(e);gl.bindBuffer(a.type,a),a.type===gl.ELEMENT_ARRAY_BUFFER?n=new Uint32Array(wasmMemory.buffer,t,r/4):(n=new Float32Array(wasmMemory.buffer,t,r/4),a.data=n),a.updated=!0,gl.bufferData(a.type,n,a.usage)},updateIndicesUsage:function(e,t,r){var n=OuterID.get(e);n.offset=t,n.count=r}},w4_resources_DataBuffer_createVerticesBuffer:function(e,t){return DataBuffer.createVerticesBuffer(DataBuffer.__internal.decryptBufferUsage(e),t)},w4_resources_DataBuffer_createIndicesBuffer:function(e){return DataBuffer.createIndicesBuffer(DataBuffer.__internal.decryptBufferUsage(e))},w4_resources_DataBuffer_updateData:function(e,t,r){DataBuffer.updateData(e,t,r)},w4_resources_DataBuffer_updateIndicesUsage:function(e,t,r){DataBuffer.updateIndicesUsage(e,t,r)},w4_resources_DataBuffer_delete:function(e){OuterID.free(e)}};autoAddDeps(DataBufferLibrary,"$DataBuffer"),mergeInto(LibraryManager.library,DataBufferLibrary);